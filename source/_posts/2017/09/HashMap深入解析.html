---
title: HashMap深入解析
date: 2017-09-27
tags: [JDK]
categories: 01后端技术
---

<?xml version='1.0' encoding='UTF-8'?><!DOCTYPE en-note SYSTEM 'http://xml.evernote.com/pub/enml2.dtd'>
<en-note lang="v2" style="color: #444444; font-size: 14px; font-family: Consolas, 'Helvetica Neue', Arial, 'Hiragino Sans GB', STHeiti, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Song, sans-serif; margin: 0 auto; line-height: 1.6;"><del style="position:relative;display:block;z-index:10;"><a href="http://maxiang.io/#/?provider=evernote_int&amp;guid=ed2f723f-3672-4db7-b92e-3ce213d6b931&amp;notebook=01%E5%90%8E%E7%AB%AF%E6%8A%80%E6%9C%AF" style="position: absolute;color: #FFF;text-decoration: none;font-size: 12px;height: 25px;border-radius: 0;margin-top: -20px;right: 15px;background: rgba(0, 0, 0, 0);border-left: 10px solid #BB3A34;border-right: 10px solid #BB3A34;border-bottom: 5px solid rgba(0, 0, 0, 0);width: 0;text-indent:-100000px;">Edit</a></del><div style="color: #444444; font-family: Consolas, 'Helvetica Neue', Arial, 'Hiragino Sans GB', STHeiti, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, Song, sans-serif; margin: 0 auto; line-height: 1.6; font-size: 14px;">
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;"></p><p style="margin: 0 0 1.1em; color: rgba(44,63,81,0.3); line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;"><code style="background-color: #f9f2f4; white-space: normal; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; padding: 2px 5px; border-radius: 0; line-height: 1.5; color: #fff; background: rgba(44,63,81,0.3); margin-right: 6px;">01后端技术</code> <code style="background-color: #f9f2f4; white-space: normal; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; padding: 2px 5px; color: rgba(44,63,81,0.5); border-radius: 0; background: rgba(102,128,153,0.075); line-height: 1.5;">JDK</code> </p><p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;"></p>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">从HashMap的<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">概念，结构，参数，性能，线程安全性，源码解析（put,get,resize），使用场景，常见问题</code>8个方面进行分析。</p>
<hr style="border: 0; -moz-box-sizing: content-box; height: 0; margin-top: 21px; margin-bottom: 21px; box-sizing: content-box; border-top: 1px solid rgba(102,128,153,0.1); margin: 0 auto 0 0; line-height: 1.6; text-align: left; color: #999;"/>
<!-- more -->
<h1 style="margin: 1.2em 0 .6em 0; font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-size: 36px; font-weight: 400; color: #111111; margin-bottom: 24px; padding: 0;">HashMap深入解析</h1>
<blockquote style="padding: 15px 20px; margin: 0 0 1.1em; border-left: 5px solid rgba(102,128,153,0.075); border-left-width: 10px; background-color: rgba(102,128,153,0.05); border-top-right-radius: 5px; border-bottom-right-radius: 5px;">
<p style="margin: 0 0 1.1em; font-weight: 300; font-size: 16px; line-height: 24px; margin-bottom: 24px; padding: 0; color: #666;">Hash table based <code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">implementation of the Map interface</code>.  <br/>
  This implementation provides all of the optional map operations, and <code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">permits null values and the null key.</code>&gt; (The HashMap class is roughly equivalent to Hashtable, except that it is <code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">unsynchronized</code> and permits nulls.)  <br/>
  This class makes <code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">no guarantees as to the order of the map</code>; in particular, it <code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">does not guarantee that the order will remain constant over time</code>.</p>
</blockquote>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">关键点：Map接口的实现、允许null键/值、非同步、不保证有序(比如插入的顺序)、不保证顺序不随时间变化。</p>
<pre style="font-family: 'Source Code Pro',monospace; background-color: rgba(102,128,153,0.05); display: block; color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 0; white-space: pre-wrap; border: 0; border-radius: 5px; text-align: start; word-break: break-all;"><code style="white-space: pre-wrap; border-radius: 0; background-color: transparent; font-family: Consolas, Monaco, Andale Mono, monospace; line-height: 1.5; font-size: 13px; color: #444; display: block; background: #F0F0F0; overflow-x: auto; padding: 1.3em 2em;"><div style="line-height: 1.6; font-size: 14px;">HashMap&lt;String, Integer&gt; map = <span style="line-height: 1.6; color: #f92672; font-weight: bold;">new</span> HashMap&lt;String, Integer&gt;();
</div><div style="line-height: 1.6; font-size: 14px;">map.put(<span style="line-height: 1.6; color: #880000;">"语文"</span>, <span style="line-height: 1.6; color: #880000;">1</span>);
</div><div style="line-height: 1.6; font-size: 14px;">map.put(<span style="line-height: 1.6; color: #880000;">"数学"</span>, <span style="line-height: 1.6; color: #880000;">2</span>);
</div><div style="line-height: 1.6; font-size: 14px;">map.put(<span style="line-height: 1.6; color: #880000;">"英语"</span>, <span style="line-height: 1.6; color: #880000;">3</span>);
</div><div style="line-height: 1.6; font-size: 14px;">map.put(<span style="line-height: 1.6; color: #880000;">"历史"</span>, <span style="line-height: 1.6; color: #880000;">4</span>);
</div><div style="line-height: 1.6; font-size: 14px;">map.put(<span style="line-height: 1.6; color: #880000;">"政治"</span>, <span style="line-height: 1.6; color: #880000;">5</span>);
</div><div style="line-height: 1.6; font-size: 14px;">map.put(<span style="line-height: 1.6; color: #880000;">"地理"</span>, <span style="line-height: 1.6; color: #880000;">6</span>);
</div><div style="line-height: 1.6; font-size: 14px;">map.put(<span style="line-height: 1.6; color: #880000;">"生物"</span>, <span style="line-height: 1.6; color: #880000;">7</span>);
</div><div style="line-height: 1.6; font-size: 14px;">map.put(<span style="line-height: 1.6; color: #880000;">"化学"</span>, <span style="line-height: 1.6; color: #880000;">8</span>);
</div><div style="line-height: 1.6; font-size: 14px;"><span style="line-height: 1.6; color: #f92672; font-weight: bold;">for</span>(Entry&lt;String, Integer&gt; entry : map.entrySet()) {
</div><div style="line-height: 1.6; font-size: 14px;">    System.out.println(entry.getKey() + <span style="line-height: 1.6; color: #880000;">": "</span> + entry.getValue());
</div><div style="line-height: 1.6; font-size: 14px;">}
</div></code></pre>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;"><en-media alt="hashmap示例" hash="ddf6a5a3693ad0d4cd5b33dbd60c7203" longdesc="./1506490529273.png" style="border: 0; vertical-align: middle; max-width: 100%;" title="" type="image/png"></en-media><img alt="hashmap示例" src="hashmap示例.png"/></p>
<h1 style="margin: 1.2em 0 .6em 0; font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-size: 36px; font-weight: 400; color: #111111; margin-bottom: 24px; padding: 0;">HashMap结构</h1>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">从结构实现来讲，HashMap是数组+链表+红黑树（JDK1.8增加了红黑树部分）实现的，如下如所示。</p>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;"><en-media alt="HashMap结构" hash="fe1d6a141b49ec6395e89c607a48860f" longdesc="./1506578135195.png" style="border: 0; vertical-align: middle; max-width: 100%;" title="" type="image/png"></en-media><img alt="HashMap结构" src="HashMap结构.png"/></p>
<ul style="margin-top: 0; margin-bottom: 1.1em; line-height: 24px; padding: 0; margin: 0; font-size: 16px;"><li style="line-height: 1.6;">HashMap类中有一个非常重要的字段，就是 <code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">Node[] table</code>，即哈希桶数组。Node是HashMap的一个内部类，实现了Map.Entry接口，本质是就是一个映射(键值对)。上图中的每个黑色圆点就是一个Node对象。</li>
</ul>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;"><en-media alt="hashmap类图" hash="b00cf8e7c49b6a1ffc8f1ff412542739" longdesc="./1506499700918.png" style="border: 0; vertical-align: middle; max-width: 100%;" title="" type="image/png"></en-media><img alt="hashmap类图" src="hashmap类图.png"/></p>
<ul style="margin-top: 0; margin-bottom: 1.1em; line-height: 24px; padding: 0; margin: 0; font-size: 16px;"><li style="line-height: 1.6;">抽象类：AbstractMap</li>
<li style="line-height: 1.6;">接口：Map</li>
<li style="line-height: 1.6;"><p style="margin: 0 0 1.1em; margin-bottom: 24px; line-height: 24px; padding: 0; font-size: 16px;">实体：EntrySet、KeySet、Node、TreeNode、Values</p></li>
<li style="line-height: 1.6;"><p style="margin: 0 0 1.1em; margin-bottom: 24px; line-height: 24px; padding: 0; font-size: 16px;">迭代器 <br/>
EntryIterator、HashIterator、KeyIterator、ValueIterator</p></li>
<li style="line-height: 1.6;"><p style="margin: 0 0 1.1em; margin-bottom: 24px; line-height: 24px; padding: 0; font-size: 16px;">分割器 <br/>
Spliterator、EntrySpliterator、HashMapSpliterator、KeySpliterator、ValueSpliterator</p></li>
</ul>
<h1 style="margin: 1.2em 0 .6em 0; font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-size: 36px; font-weight: 400; color: #111111; margin-bottom: 24px; padding: 0;">HashMap参数</h1>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">在HashMap中有2个重要参数， Capacity和Load factor</p>
<h2 style="font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-weight: 400; color: #111111; margin-bottom: 24px; font-size: 24px; margin: 24px 0 6px; padding: 0;">Capacity（容量）</h2>
<blockquote style="padding: 15px 20px; margin: 0 0 1.1em; border-left: 5px solid rgba(102,128,153,0.075); border-left-width: 10px; background-color: rgba(102,128,153,0.05); border-top-right-radius: 5px; border-bottom-right-radius: 5px;">
<p style="margin: 0 0 1.1em; font-weight: 300; font-size: 16px; line-height: 24px; margin-bottom: 24px; padding: 0; color: #666;">The capacity is the <code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">number of buckets</code> in the hash table, The initial capacity is simply the capacity at the time the hash table is created. <br/>
<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">Capacity</code>就是buckets的数目，默认值为16。</p>
</blockquote>
<h2 style="font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-weight: 400; color: #111111; margin-bottom: 24px; font-size: 24px; margin: 24px 0 6px; padding: 0;">Load factor（负载因子）</h2>
<blockquote style="padding: 15px 20px; margin: 0 0 1.1em; border-left: 5px solid rgba(102,128,153,0.075); border-left-width: 10px; background-color: rgba(102,128,153,0.05); border-top-right-radius: 5px; border-bottom-right-radius: 5px;">
<p style="margin: 0 0 1.1em; font-weight: 300; font-size: 16px; line-height: 24px; margin-bottom: 24px; padding: 0; color: #666;">The load factor is a measure of how full the hash table is allowed to get before its capacity is automatically increased.</p>
</blockquote>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;"><code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">Load factor</code>是buckets填满程度的最大比例，默认值为0.75，当<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">bucket</code>填充的数目（即hashmap中元素的个数）大于<span style="line-height: 1.6;"><span style="word-wrap: normal; vertical-align: middle; font-style: normal; font-weight: normal; margin: 0; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; padding: 0; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; line-height: 1.6; display: inline-block; font-size: 100%;"><span style="line-height: 1.6;"><en-media hash="168b64a4b678a617e88987a80bc9ca61" height="17" longdesc="__SVG__6b1197535a13ccfd61d8f1dd825b04b2" style="border: 0; vertical-align: middle; max-width: 100%; margin-top: 0; margin-bottom: 0;" type="image/png" width="162"></en-media><img alt src="168b64a4b678a617e88987a80bc9ca61.png"/></span></span></span>时就需要调整buckets的数目为当前的2倍。</p>
<h1 style="margin: 1.2em 0 .6em 0; font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-size: 36px; font-weight: 400; color: #111111; margin-bottom: 24px; padding: 0;">HashMap性能</h1>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">当前实现的HashMap实现提供了<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">constant-time</code>的方法来进行get, put 等基本操作。</p>
<ul style="margin-top: 0; margin-bottom: 1.1em; line-height: 24px; padding: 0; margin: 0; font-size: 16px;"><li style="line-height: 1.6;">如果key经过hash算法得出的数组索引位置全部不相同，即Hash算法非常好，那样的话，getKey方法的时间复杂度就是<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">O(1)</code>，</li>
<li style="line-height: 1.6;">如果Hash算法技术的结果碰撞非常多，假如Hash算极其差，所有的Hash算法结果得出的索引位置一样，那样所有的键值对都集中到一个桶中，或者在一个链表中，或者在一个红黑树中，时间复杂度分别为<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">O(n)</code>和<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">O(lgn)</code>。</li>
</ul>
<h2 style="font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-weight: 400; color: #111111; margin-bottom: 24px; font-size: 24px; margin: 24px 0 6px; padding: 0;">几个要注意的性能点（空间/时间的tradeoff）</h2>
<ol style="margin-top: 0; margin-bottom: 1.1em; line-height: 24px; padding: 0; margin: 0; font-size: 16px;"><li style="line-height: 1.6;">假如哈希函数能够将元素分散到所有的buckets里。从Collection的角度来说，遍历HashMap需要的时间为<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">count(buckets)+count(bucket.entrySize)</code>。如果遍历频繁/对迭代性能要求很高，不要把<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">capacity</code>设置过大，也不要把<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">load factor</code>设置过小；<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">load factor</code>更大会减少空间消耗，更小会增加时间消耗（查找更费时）。</li>
<li style="line-height: 1.6;">扩容是一个特别耗性能的操作，如果很多key-values对存储在 HashMap 实例中，给他<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">初始化一个足够大的capacity</code> ，避免map进行频繁的resize扩容。这样更有效率。</li>
<li style="line-height: 1.6;">默认的<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">load factor=0.75</code>是对空间和时间效率的一个<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">平衡选择</code>，建议不要修改，除非在时间和空间比较特殊的情况下，如果内存空间很多而又对时间效率要求很高，可以降低负载因子Load factor的值；相反，如果内存空间紧张而对时间效率要求不高，可以增加负载因子loadFactor的值，这个值可以大于1。</li>
</ol>
<h1 style="margin: 1.2em 0 .6em 0; font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-size: 36px; font-weight: 400; color: #111111; margin-bottom: 24px; padding: 0;">HashMap线程安全性</h1>
<h2 style="font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-weight: 400; color: #111111; margin-bottom: 24px; font-size: 24px; margin: 24px 0 6px; padding: 0;">HashMap为什么线程不安全</h2>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">为什么HashMap是线程不安全的？</p>
<ol style="margin-top: 0; margin-bottom: 1.1em; line-height: 24px; padding: 0; margin: 0; font-size: 16px;"><li style="line-height: 1.6;"><code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">多线程put-哈希碰撞问题</code>：如果多个线程同时使用put方法添加元素，而且假设正好存在两个 put 的 key 发生了碰撞(根据 hash 值计算的 bucket 一样)，那么根据 HashMap 的实现，这两个 key 会添加到数组的同一个位置，这样最终就会发生其中一个线程的 put 的数据被覆盖；</li>
<li style="line-height: 1.6;"><code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">多线程put-死循环问题</code>：ashMap 在并发执行 put 操作时会引起死循环，导致 CPU 利用率接近100%。因为多线程会导致 HashMap 的 Node 链表形成环形数据结构，一旦形成环形数据结构，Node 的 next 节点永远不为空，就会在获取 Node 时产生死循环。-《Java并发编程的艺术》</li>
<li style="line-height: 1.6;"><code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">多线程resize-数据丢失问题</code>：如果多个线程同时检测到元素个数超过<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">table size* loadFactor</code> ，这样就会发生多个线程同时对 Node 数组进行扩容，都在重新计算元素位置以及复制数据，但是最终只有一个线程扩容后的数组会赋给 table，也就是说其他线程的都会丢失，并且各自线程 put 的数据也丢失；</li>
</ol>
<h2 style="font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-weight: 400; color: #111111; margin-bottom: 24px; font-size: 24px; margin: 24px 0 6px; padding: 0;">HashMap线程安全初始化</h2>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">在多线程使用场景中，应该尽量避免使用线程不安全的<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">HashMap</code>，可用以下2种方式实现线程安全：</p>
<ol style="margin-top: 0; margin-bottom: 1.1em; line-height: 24px; padding: 0; margin: 0; font-size: 16px;"><li style="line-height: 1.6;">ConcurrentHashMap： <code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">Map map = new ConcurrentHashMap&lt;String, Object&gt;();</code></li>
<li style="line-height: 1.6;">Collections.synchronizedMap：<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">Map map = Collections.synchronizedMap(new HashMap&lt;String, Object&gt;());</code></li>
</ol>
<h1 style="margin: 1.2em 0 .6em 0; font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-size: 36px; font-weight: 400; color: #111111; margin-bottom: 24px; padding: 0;">HashMap源码解析</h1>
<h2 style="font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-weight: 400; color: #111111; margin-bottom: 24px; font-size: 24px; margin: 24px 0 6px; padding: 0;">hashcode方法</h2>
<pre style="font-family: 'Source Code Pro',monospace; background-color: rgba(102,128,153,0.05); display: block; color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 0; white-space: pre-wrap; border: 0; border-radius: 5px; text-align: start; word-break: break-all;"><code style="white-space: pre-wrap; border-radius: 0; background-color: transparent; font-family: Consolas, Monaco, Andale Mono, monospace; line-height: 1.5; font-size: 13px; color: #444; display: block; background: #F0F0F0; overflow-x: auto; padding: 1.3em 2em;"><div style="line-height: 1.6; font-size: 14px;"><span style="line-height: 1.6; color: #f92672;"><span style="line-height: 1.6; font-weight: bold; color: #66d9ef;">static</span> <span style="line-height: 1.6; font-weight: bold; color: #66d9ef;">final</span> <span style="line-height: 1.6; font-weight: bold; color: #66d9ef;">int</span> <span style="line-height: 1.6; color: #880000; font-weight: bold;">hash</span><span style="line-height: 1.6; color: #f8f8f2;">(Object key)</span> </span>{
</div><div style="line-height: 1.6; font-size: 14px;">    <span style="line-height: 1.6; color: #f92672; font-weight: bold;">int</span> h;
</div><div style="line-height: 1.6; font-size: 14px;">    <span style="line-height: 1.6; color: #888888;">//扰动函数</span>
</div><div style="line-height: 1.6; font-size: 14px;">    <span style="line-height: 1.6; color: #f92672; font-weight: bold;">return</span> (key == <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>) ? <span style="line-height: 1.6; color: #880000;">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span style="line-height: 1.6; color: #880000;">16</span>);
</div><div style="line-height: 1.6; font-size: 14px;">}
</div></code></pre>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;"><en-media alt="hashcode方法" hash="71c864a146ea6f7cb7ecb1883d8b9355" longdesc="./1506556253947.png" style="border: 0; vertical-align: middle; max-width: 100%;" title="" type="image/png"></en-media><img alt="hashcode方法" src="hashcode方法.png"/></p>
<blockquote style="padding: 15px 20px; margin: 0 0 1.1em; border-left: 5px solid rgba(102,128,153,0.075); border-left-width: 10px; background-color: rgba(102,128,153,0.05); border-top-right-radius: 5px; border-bottom-right-radius: 5px;">
<p style="margin: 0 0 1.1em; font-weight: 300; font-size: 16px; line-height: 24px; margin-bottom: 24px; padding: 0; color: #666;">扰动函数：右位移16位，正好是32bit的一半，自己的高半区和低半区做异或，就是为了<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">混合原始哈希码的高位和低位</code>，以此来加大低位的随机性。而且混合后的低位掺杂了高位的部分特征，这样高位的信息也被变相保留下来。</p>
<p style="margin: 0 0 1.1em; font-weight: 300; font-size: 16px; line-height: 24px; margin-bottom: 24px; padding: 0; color: #666;">Computes key.hashCode() and <code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">spreads (XORs) higher bits of hash to lower.</code> Because the table uses power-of-two masking, sets of hashes that vary only in bits above the current mask will always collide. (Among known examples are sets of Float keys holding consecutive whole numbers in small tables.) So we apply a transform that <code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">spreads the impact of higher bits downward</code>. There is a <code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">tradeoff</code> between <code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">speed, utility, and quality of bit-spreading</code>. Because many common sets of hashes are already <code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">reasonably distributed</code> (so don’t benefit from spreading), and because we <code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">use trees to handle large sets of collisions in bins</code>, we just XOR some shifted bits in the cheapest possible way to reduce systematic lossage, as well as to incorporate impact of the highest bits that would otherwise never be used in index calculations because of table bounds.</p>
</blockquote>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">在设计hash函数时，因为目前的table长度n为2的幂，而计算下标的时候，是这样实现的(使用<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">&amp;</code>位操作，而非<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">%</code>求余)：</p>
<pre style="font-family: 'Source Code Pro',monospace; background-color: rgba(102,128,153,0.05); display: block; color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 0; white-space: pre-wrap; border: 0; border-radius: 5px; text-align: start; word-break: break-all;"><code style="white-space: pre-wrap; border-radius: 0; background-color: transparent; font-family: Consolas, Monaco, Andale Mono, monospace; line-height: 1.5; font-size: 13px; color: #444; display: block; background: #F0F0F0; overflow-x: auto; padding: 1.3em 2em;"><div style="line-height: 1.6; font-size: 14px;">(n - <span style="line-height: 1.6; color: #880000;">1</span>) &amp; hash
</div></code></pre>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">设计者认为这方法很容易发生碰撞。为什么这么说呢？不妨思考一下，在n - 1为15(<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">0000000000000000 0000000000001111</code>)时，其实散列真正生效的只是低4bit的有效位，当然容易碰撞了。</p>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">因此，设计者想了一个顾全大局的方法(综合考虑了<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">速度、作用、质量</code>)，就是把高16bit和低16bit进行异或运算。设计者还解释到因为现在大多数的hashCode的分布已经很不错了，就算是发生了碰撞也用<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">O(log_n)</code>的tree去做了。 <br/>
仅仅异或运算，既减少了系统的开销，也不会造成的因为高位没有参与下标的计算(table长度比较小时)，从而引起的碰撞。</p>
<h2 style="font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-weight: 400; color: #111111; margin-bottom: 24px; font-size: 24px; margin: 24px 0 6px; padding: 0;">put方法</h2>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;"><en-media alt="HashMap之put方法" hash="80ee4f179bbfe5172029565f93d34817" longdesc="./1506579984225.png" style="border: 0; vertical-align: middle; max-width: 100%;" title="" type="image/png"></en-media><img alt="HashMap之put方法" src="HashMap之put方法.png"/></p>
<pre style="font-family: 'Source Code Pro',monospace; background-color: rgba(102,128,153,0.05); display: block; color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 0; white-space: pre-wrap; border: 0; border-radius: 5px; text-align: start; word-break: break-all;"><code style="white-space: pre-wrap; border-radius: 0; background-color: transparent; font-family: Consolas, Monaco, Andale Mono, monospace; line-height: 1.5; font-size: 13px; color: #444; display: block; background: #F0F0F0; overflow-x: auto; padding: 1.3em 2em;"><div style="line-height: 1.6; font-size: 14px;">    <span style="line-height: 1.6; color: #f92672;"><span style="line-height: 1.6; font-weight: bold; color: #66d9ef;">public</span> V <span style="line-height: 1.6; color: #880000; font-weight: bold;">put</span><span style="line-height: 1.6; color: #f8f8f2;">(K key, V value)</span> </span>{
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #888888;">//对key的hashCode进行16位异或混合</span>
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">return</span> putVal(hash(key), key, value, <span style="line-height: 1.6; color: #f92672; font-weight: bold;">false</span>, <span style="line-height: 1.6; color: #f92672; font-weight: bold;">true</span>);
</div><div style="line-height: 1.6; font-size: 14px;">    }
</div><div style="line-height: 1.6; font-size: 14px;">
</div><div style="line-height: 1.6; font-size: 14px;">    <span style="line-height: 1.6; color: #888888;">/**
</span></div><div style="line-height: 1.6; font-size: 14px;">     * Implements Map.put and related methods
</div><div style="line-height: 1.6; font-size: 14px;">     */
</div><div style="line-height: 1.6; font-size: 14px;">    <span style="line-height: 1.6; color: #f92672;"><span style="line-height: 1.6; font-weight: bold; color: #66d9ef;">final</span> V <span style="line-height: 1.6; color: #880000; font-weight: bold;">putVal</span><span style="line-height: 1.6; color: #f8f8f2;">(<span style="line-height: 1.6; font-weight: bold; color: #66d9ef;">int</span> hash, K key, V value, <span style="line-height: 1.6; font-weight: bold; color: #66d9ef;">boolean</span> onlyIfAbsent,
</span></span></div><div style="line-height: 1.6; font-size: 14px;">                   <span style="line-height: 1.6; color: #f92672; font-weight: bold;">boolean</span> evict) {
</div><div style="line-height: 1.6; font-size: 14px;">        Node&lt;K,V&gt;[] tab; 
</div><div style="line-height: 1.6; font-size: 14px;">        Node&lt;K,V&gt; p; 
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #888888;">//n为hashtable的长度，i为</span>
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">int</span> n, i;
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #888888;">// tab为空则初始化table</span>
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> ((tab = table) == <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span> || (n = tab.length) == <span style="line-height: 1.6; color: #880000;">0</span>)
</div><div style="line-height: 1.6; font-size: 14px;">            n = (tab = resize()).length;
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #888888;">//计算table数组下标，位运算：(n-1)&amp;hash；若该下标不为null则新增Node</span>
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> ((p = tab[i = (n - <span style="line-height: 1.6; color: #880000;">1</span>) &amp; hash]) == <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>)
</div><div style="line-height: 1.6; font-size: 14px;">            tab[i] = newNode(hash, key, value, <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>);
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">else</span> {
</div><div style="line-height: 1.6; font-size: 14px;">            Node&lt;K,V&gt; e; K k;
</div><div style="line-height: 1.6; font-size: 14px;">            <span style="line-height: 1.6; color: #888888;">//节点存在：key哈希值一致 ，key的内存地址一致 || key不为null &amp; 实际实体一致，</span>
</div><div style="line-height: 1.6; font-size: 14px;">            <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span> &amp;&amp; key.equals(k))))
</div><div style="line-height: 1.6; font-size: 14px;">                e = p;
</div><div style="line-height: 1.6; font-size: 14px;">             <span style="line-height: 1.6; color: #888888;">// 该链为红黑树</span>
</div><div style="line-height: 1.6; font-size: 14px;">            <span style="line-height: 1.6; color: #f92672; font-weight: bold;">else</span> <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> (p <span style="line-height: 1.6; color: #f92672; font-weight: bold;">instanceof</span> TreeNode)
</div><div style="line-height: 1.6; font-size: 14px;">                e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span style="line-height: 1.6; color: #f92672; font-weight: bold;">this</span>, tab, hash, key, value);
</div><div style="line-height: 1.6; font-size: 14px;">            <span style="line-height: 1.6; color: #888888;">// 该链为链表</span>
</div><div style="line-height: 1.6; font-size: 14px;">            <span style="line-height: 1.6; color: #f92672; font-weight: bold;">else</span> {
</div><div style="line-height: 1.6; font-size: 14px;">                <span style="line-height: 1.6; color: #f92672; font-weight: bold;">for</span> (<span style="line-height: 1.6; color: #f92672; font-weight: bold;">int</span> binCount = <span style="line-height: 1.6; color: #880000;">0</span>; ; ++binCount) {
</div><div style="line-height: 1.6; font-size: 14px;">                    <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> ((e = p.next) == <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>) {
</div><div style="line-height: 1.6; font-size: 14px;">                        p.next = newNode(hash, key, value, <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>);
</div><div style="line-height: 1.6; font-size: 14px;">                        <span style="line-height: 1.6; color: #888888;">//链表长度大于8转换为红黑树进行处理</span>
</div><div style="line-height: 1.6; font-size: 14px;">                        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span style="line-height: 1.6; color: #880000;">1</span>) <span style="line-height: 1.6; color: #888888;">// -1 for 1st</span>
</div><div style="line-height: 1.6; font-size: 14px;">                            treeifyBin(tab, hash);
</div><div style="line-height: 1.6; font-size: 14px;">                        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">break</span>;
</div><div style="line-height: 1.6; font-size: 14px;">                    }
</div><div style="line-height: 1.6; font-size: 14px;">                    <span style="line-height: 1.6; color: #888888;">// key已经存在直接覆盖value</span>
</div><div style="line-height: 1.6; font-size: 14px;">                    <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> (e.hash == hash &amp;&amp;
</div><div style="line-height: 1.6; font-size: 14px;">                        ((k = e.key) == key || (key != <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span> &amp;&amp; key.equals(k))))
</div><div style="line-height: 1.6; font-size: 14px;">                        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">break</span>;
</div><div style="line-height: 1.6; font-size: 14px;">                    p = e;
</div><div style="line-height: 1.6; font-size: 14px;">                }
</div><div style="line-height: 1.6; font-size: 14px;">            }
</div><div style="line-height: 1.6; font-size: 14px;">            <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> (e != <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>) { <span style="line-height: 1.6; color: #888888;">// existing mapping for key</span>
</div><div style="line-height: 1.6; font-size: 14px;">                V oldValue = e.value;
</div><div style="line-height: 1.6; font-size: 14px;">                <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> (!onlyIfAbsent || oldValue == <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>)
</div><div style="line-height: 1.6; font-size: 14px;">                    e.value = value;
</div><div style="line-height: 1.6; font-size: 14px;">                afterNodeAccess(e);
</div><div style="line-height: 1.6; font-size: 14px;">                <span style="line-height: 1.6; color: #f92672; font-weight: bold;">return</span> oldValue;
</div><div style="line-height: 1.6; font-size: 14px;">            }
</div><div style="line-height: 1.6; font-size: 14px;">        }
</div><div style="line-height: 1.6; font-size: 14px;">        ++modCount;
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #888888;">//超过最大容量（load factor*current capacity），就扩容</span>
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> (++size &gt; threshold)
</div><div style="line-height: 1.6; font-size: 14px;">            resize();
</div><div style="line-height: 1.6; font-size: 14px;">        afterNodeInsertion(evict);
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">return</span> <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>;
</div><div style="line-height: 1.6; font-size: 14px;">    }
</div></code></pre>
<h2 style="font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-weight: 400; color: #111111; margin-bottom: 24px; font-size: 24px; margin: 24px 0 6px; padding: 0;">get方法</h2>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">get大致思路如下：</p>
<ul style="margin-top: 0; margin-bottom: 1.1em; line-height: 24px; padding: 0; margin: 0; font-size: 16px;"><li style="line-height: 1.6;">bucket里的第一个节点，直接命中；</li>
<li style="line-height: 1.6;">如果有冲突，则通过key.equals(k)去查找对应的entry</li>
<li style="line-height: 1.6;">若为树，则在树中通过key.equals(k)查找，O(logn)；</li>
<li style="line-height: 1.6;">若为链表，则在链表中通过key.equals(k)查找，O(n)。 <br/>
具体代码的实现如下：</li>
</ul>
<pre style="font-family: 'Source Code Pro',monospace; background-color: rgba(102,128,153,0.05); display: block; color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 0; white-space: pre-wrap; border: 0; border-radius: 5px; text-align: start; word-break: break-all;"><code style="white-space: pre-wrap; border-radius: 0; background-color: transparent; font-family: Consolas, Monaco, Andale Mono, monospace; line-height: 1.5; font-size: 13px; color: #444; display: block; background: #F0F0F0; overflow-x: auto; padding: 1.3em 2em;"><div style="line-height: 1.6; font-size: 14px;">    <span style="line-height: 1.6; color: #f92672;"><span style="line-height: 1.6; font-weight: bold; color: #66d9ef;">public</span> V <span style="line-height: 1.6; color: #880000; font-weight: bold;">get</span><span style="line-height: 1.6; color: #f8f8f2;">(Object key)</span> </span>{
</div><div style="line-height: 1.6; font-size: 14px;">        Node&lt;K,V&gt; e;
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">return</span> (e = getNode(hash(key), key)) == <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span> ? <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span> : e.value;
</div><div style="line-height: 1.6; font-size: 14px;">    }
</div><div style="line-height: 1.6; font-size: 14px;">
</div><div style="line-height: 1.6; font-size: 14px;">    <span style="line-height: 1.6; color: #888888;">/**
</span></div><div style="line-height: 1.6; font-size: 14px;">     * Implements Map.get and related methods
</div><div style="line-height: 1.6; font-size: 14px;">     */
</div><div style="line-height: 1.6; font-size: 14px;">    <span style="line-height: 1.6; color: #f92672;"><span style="line-height: 1.6; font-weight: bold; color: #66d9ef;">final</span> Node&lt;K,V&gt; <span style="line-height: 1.6; color: #880000; font-weight: bold;">getNode</span><span style="line-height: 1.6; color: #f8f8f2;">(<span style="line-height: 1.6; font-weight: bold; color: #66d9ef;">int</span> hash, Object key)</span> </span>{
</div><div style="line-height: 1.6; font-size: 14px;">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span style="line-height: 1.6; color: #f92672; font-weight: bold;">int</span> n; K k;
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> ((tab = table) != <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span> &amp;&amp; (n = tab.length) &gt; <span style="line-height: 1.6; color: #880000;">0</span> &amp;&amp;
</div><div style="line-height: 1.6; font-size: 14px;">            (first = tab[(n - <span style="line-height: 1.6; color: #880000;">1</span>) &amp; hash]) != <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>) {
</div><div style="line-height: 1.6; font-size: 14px;">            <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> (first.hash == hash &amp;&amp; <span style="line-height: 1.6; color: #888888;">// always check first node</span>
</div><div style="line-height: 1.6; font-size: 14px;">                ((k = first.key) == key || (key != <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span> &amp;&amp; key.equals(k))))
</div><div style="line-height: 1.6; font-size: 14px;">                <span style="line-height: 1.6; color: #f92672; font-weight: bold;">return</span> first;
</div><div style="line-height: 1.6; font-size: 14px;">            <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> ((e = first.next) != <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>) {
</div><div style="line-height: 1.6; font-size: 14px;">                <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> (first <span style="line-height: 1.6; color: #f92672; font-weight: bold;">instanceof</span> TreeNode)
</div><div style="line-height: 1.6; font-size: 14px;">                    <span style="line-height: 1.6; color: #f92672; font-weight: bold;">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);
</div><div style="line-height: 1.6; font-size: 14px;">                <span style="line-height: 1.6; color: #f92672; font-weight: bold;">do</span> {
</div><div style="line-height: 1.6; font-size: 14px;">                    <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> (e.hash == hash &amp;&amp;
</div><div style="line-height: 1.6; font-size: 14px;">                        ((k = e.key) == key || (key != <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span> &amp;&amp; key.equals(k))))
</div><div style="line-height: 1.6; font-size: 14px;">                        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">return</span> e;
</div><div style="line-height: 1.6; font-size: 14px;">                } <span style="line-height: 1.6; color: #f92672; font-weight: bold;">while</span> ((e = e.next) != <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>);
</div><div style="line-height: 1.6; font-size: 14px;">            }
</div><div style="line-height: 1.6; font-size: 14px;">        }
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">return</span> <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>;
</div><div style="line-height: 1.6; font-size: 14px;">    }
</div></code></pre>
<h2 style="font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-weight: 400; color: #111111; margin-bottom: 24px; font-size: 24px; margin: 24px 0 6px; padding: 0;">resize方法</h2>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">当put时，如果发现目前的bucket占用程度已经超过了Load Factor所希望的比例，那么就会发生resize。</p>
<blockquote style="padding: 15px 20px; margin: 0 0 1.1em; border-left: 5px solid rgba(102,128,153,0.075); border-left-width: 10px; background-color: rgba(102,128,153,0.05); border-top-right-radius: 5px; border-bottom-right-radius: 5px;">
<p style="margin: 0 0 1.1em; font-weight: 300; font-size: 16px; line-height: 24px; margin-bottom: 24px; padding: 0; color: #666;">如果不进行resize扩容，单个链表中的数据过多，get(),put(),remove()等方法效率都会降低。</p>
</blockquote>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">在resize的过程，简单的说就是把bucket扩充为2倍，之后重新计算index，把节点再放到新的bucket中。resize的注释是这样描述的：</p>
<blockquote style="padding: 15px 20px; margin: 0 0 1.1em; border-left: 5px solid rgba(102,128,153,0.075); border-left-width: 10px; background-color: rgba(102,128,153,0.05); border-top-right-radius: 5px; border-bottom-right-radius: 5px;">
<p style="margin: 0 0 1.1em; font-weight: 300; font-size: 16px; line-height: 24px; margin-bottom: 24px; padding: 0; color: #666;">Initializes or doubles table size. If null, allocates in accord with initial capacity target held in field threshold. Otherwise, because we are using <code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">power-of-two expansion</code>, the elements from each bin must either stay at same index, or move with a power of <code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">two offset</code> in the new table. <br/>
  大致意思就是说，当超过限制的时候会resize，然而又因为我们使用的是<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">2次幂</code>的扩展(指长度扩为原来2倍)，所以，元素的位置要么是在原位置，要么是在原位置再移动2次幂的位置。</p>
</blockquote>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">怎么理解呢？例如我们从16扩展为32时，具体的变化如下所示：</p>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;"><en-media alt="hash" hash="1bac6d2076e388a76d841b0f93bd65bb" longdesc="./1506580586999.png" style="border: 0; vertical-align: middle; max-width: 100%;" title="" type="image/png"></en-media><img alt="hash" src="hash.png"/> <br/>
因此元素在重新计算hash之后，因为n变为2倍，那么n-1的mask范围在高位多1bit(红色)，因此新的index就会发生这样的变化：</p>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;"><en-media alt="resize" hash="5f8cfccb993d81c9f3f7e1f154c8535a" longdesc="./1506567517084.png" style="border: 0; vertical-align: middle; max-width: 100%;" title="" type="image/png"></en-media><img alt="resize" src="resize.png"/> <br/>
因此，我们在扩充HashMap的时候，不需要重新计算hash，只需要看看<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">原来的hash值新增的那个bit是1还是0</code>就好了，是0的话索引没变，是1的话索引变成<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">原索引+oldCap</code>。可以看看下图为16扩充为32的resize示意图：</p>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;"><en-media alt="resize16to32" hash="4571a642afc15887fc7090b647477c8e" longdesc="./1506567534575.png" style="border: 0; vertical-align: middle; max-width: 100%;" title="" type="image/png"></en-media><img alt="resize16to32" src="resize16to32.png"/> <br/>
这个设计确实非常的巧妙，既省去了重新计算hash值的时间，而且同时，由于新增的1bit是0还是1可以认为是随机的，因此resize的过程，<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">均匀的把之前的冲突的节点分散到新的bucket</code>了。</p>
<blockquote style="padding: 15px 20px; margin: 0 0 1.1em; border-left: 5px solid rgba(102,128,153,0.075); border-left-width: 10px; background-color: rgba(102,128,153,0.05); border-top-right-radius: 5px; border-bottom-right-radius: 5px;">
<p style="margin: 0 0 1.1em; font-weight: 300; font-size: 16px; line-height: 24px; margin-bottom: 24px; padding: 0; color: #666;">resize源码</p>
</blockquote>
<pre style="font-family: 'Source Code Pro',monospace; background-color: rgba(102,128,153,0.05); display: block; color: #333; word-wrap: break-word; font-size: .9em; background: #f6f6f6; line-height: 1.6; margin: 0 0 1.1em; padding: 0; white-space: pre-wrap; border: 0; border-radius: 5px; text-align: start; word-break: break-all;"><code style="white-space: pre-wrap; border-radius: 0; background-color: transparent; font-family: Consolas, Monaco, Andale Mono, monospace; line-height: 1.5; font-size: 13px; color: #444; display: block; background: #F0F0F0; overflow-x: auto; padding: 1.3em 2em;"><div style="line-height: 1.6; font-size: 14px;">    <span style="line-height: 1.6; color: #f92672; font-weight: bold;">final</span> Node&lt;K,V&gt;[] resize() {
</div><div style="line-height: 1.6; font-size: 14px;">        Node&lt;K,V&gt;[] oldTab = table;
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">int</span> oldCap = (oldTab == <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>) ? <span style="line-height: 1.6; color: #880000;">0</span> : oldTab.length;
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">int</span> oldThr = threshold;
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">int</span> newCap, newThr = <span style="line-height: 1.6; color: #880000;">0</span>;
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> (oldCap &gt; <span style="line-height: 1.6; color: #880000;">0</span>) {
</div><div style="line-height: 1.6; font-size: 14px;">            <span style="line-height: 1.6; color: #888888;">// 超过最大值就不再扩充了</span>
</div><div style="line-height: 1.6; font-size: 14px;">            <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) {
</div><div style="line-height: 1.6; font-size: 14px;">                threshold = Integer.MAX_VALUE;
</div><div style="line-height: 1.6; font-size: 14px;">                <span style="line-height: 1.6; color: #f92672; font-weight: bold;">return</span> oldTab;
</div><div style="line-height: 1.6; font-size: 14px;">            }
</div><div style="line-height: 1.6; font-size: 14px;">            <span style="line-height: 1.6; color: #888888;">// 没超过最大值，就扩充为原来的2倍</span>
</div><div style="line-height: 1.6; font-size: 14px;">            <span style="line-height: 1.6; color: #f92672; font-weight: bold;">else</span> <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> ((newCap = oldCap &lt;&lt; <span style="line-height: 1.6; color: #880000;">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;
</div><div style="line-height: 1.6; font-size: 14px;">                     oldCap &gt;= DEFAULT_INITIAL_CAPACITY)
</div><div style="line-height: 1.6; font-size: 14px;">                newThr = oldThr &lt;&lt; <span style="line-height: 1.6; color: #880000;">1</span>; <span style="line-height: 1.6; color: #888888;">// double threshold</span>
</div><div style="line-height: 1.6; font-size: 14px;">        }
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">else</span> <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> (oldThr &gt; <span style="line-height: 1.6; color: #880000;">0</span>) <span style="line-height: 1.6; color: #888888;">// initial capacity was placed in threshold</span>
</div><div style="line-height: 1.6; font-size: 14px;">            newCap = oldThr;
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">else</span> {               <span style="line-height: 1.6; color: #888888;">// zero initial threshold signifies using defaults</span>
</div><div style="line-height: 1.6; font-size: 14px;">            newCap = DEFAULT_INITIAL_CAPACITY;
</div><div style="line-height: 1.6; font-size: 14px;">            newThr = (<span style="line-height: 1.6; color: #f92672; font-weight: bold;">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);
</div><div style="line-height: 1.6; font-size: 14px;">        }
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #888888;">// 计算新的resize上限</span>
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> (newThr == <span style="line-height: 1.6; color: #880000;">0</span>) {
</div><div style="line-height: 1.6; font-size: 14px;">            <span style="line-height: 1.6; color: #f92672; font-weight: bold;">float</span> ft = (<span style="line-height: 1.6; color: #f92672; font-weight: bold;">float</span>)newCap * loadFactor;
</div><div style="line-height: 1.6; font-size: 14px;">            newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span style="line-height: 1.6; color: #f92672; font-weight: bold;">float</span>)MAXIMUM_CAPACITY ?
</div><div style="line-height: 1.6; font-size: 14px;">                      (<span style="line-height: 1.6; color: #f92672; font-weight: bold;">int</span>)ft : Integer.MAX_VALUE);
</div><div style="line-height: 1.6; font-size: 14px;">        }
</div><div style="line-height: 1.6; font-size: 14px;">        threshold = newThr;
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #1f7199;">@SuppressWarnings</span>({<span style="line-height: 1.6; color: #880000;">"rawtypes"</span>,<span style="line-height: 1.6; color: #880000;">"unchecked"</span>})
</div><div style="line-height: 1.6; font-size: 14px;">            Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span style="line-height: 1.6; color: #f92672; font-weight: bold;">new</span> Node[newCap];
</div><div style="line-height: 1.6; font-size: 14px;">        table = newTab;
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> (oldTab != <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>) {
</div><div style="line-height: 1.6; font-size: 14px;">            <span style="line-height: 1.6; color: #888888;">// 把每个bucket都移动到新的buckets中</span>
</div><div style="line-height: 1.6; font-size: 14px;">            <span style="line-height: 1.6; color: #f92672; font-weight: bold;">for</span> (<span style="line-height: 1.6; color: #f92672; font-weight: bold;">int</span> j = <span style="line-height: 1.6; color: #880000;">0</span>; j &lt; oldCap; ++j) {
</div><div style="line-height: 1.6; font-size: 14px;">                Node&lt;K,V&gt; e;
</div><div style="line-height: 1.6; font-size: 14px;">                <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> ((e = oldTab[j]) != <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>) {
</div><div style="line-height: 1.6; font-size: 14px;">                    oldTab[j] = <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>;
</div><div style="line-height: 1.6; font-size: 14px;">                    <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> (e.next == <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>)
</div><div style="line-height: 1.6; font-size: 14px;">                        newTab[e.hash &amp; (newCap - <span style="line-height: 1.6; color: #880000;">1</span>)] = e;
</div><div style="line-height: 1.6; font-size: 14px;">                    <span style="line-height: 1.6; color: #f92672; font-weight: bold;">else</span> <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> (e <span style="line-height: 1.6; color: #f92672; font-weight: bold;">instanceof</span> TreeNode)
</div><div style="line-height: 1.6; font-size: 14px;">                        ((TreeNode&lt;K,V&gt;)e).split(<span style="line-height: 1.6; color: #f92672; font-weight: bold;">this</span>, newTab, j, oldCap);
</div><div style="line-height: 1.6; font-size: 14px;">                    <span style="line-height: 1.6; color: #f92672; font-weight: bold;">else</span> { <span style="line-height: 1.6; color: #888888;">// preserve order</span>
</div><div style="line-height: 1.6; font-size: 14px;">                         <span style="line-height: 1.6; color: #888888;">// 链表优化重hash的代码块</span>
</div><div style="line-height: 1.6; font-size: 14px;">                        Node&lt;K,V&gt; loHead = <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>, loTail = <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>;
</div><div style="line-height: 1.6; font-size: 14px;">                        Node&lt;K,V&gt; hiHead = <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>, hiTail = <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>;
</div><div style="line-height: 1.6; font-size: 14px;">                        Node&lt;K,V&gt; next;
</div><div style="line-height: 1.6; font-size: 14px;">                        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">do</span> {
</div><div style="line-height: 1.6; font-size: 14px;">                            next = e.next;
</div><div style="line-height: 1.6; font-size: 14px;">                            <span style="line-height: 1.6; color: #888888;">// 原索引</span>
</div><div style="line-height: 1.6; font-size: 14px;">                            <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> ((e.hash &amp; oldCap) == <span style="line-height: 1.6; color: #880000;">0</span>) {
</div><div style="line-height: 1.6; font-size: 14px;">                                <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> (loTail == <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>)
</div><div style="line-height: 1.6; font-size: 14px;">                                    loHead = e;
</div><div style="line-height: 1.6; font-size: 14px;">                                <span style="line-height: 1.6; color: #f92672; font-weight: bold;">else</span>
</div><div style="line-height: 1.6; font-size: 14px;">                                    loTail.next = e;
</div><div style="line-height: 1.6; font-size: 14px;">                                loTail = e;
</div><div style="line-height: 1.6; font-size: 14px;">                            }
</div><div style="line-height: 1.6; font-size: 14px;">                            <span style="line-height: 1.6; color: #888888;">// 原索引+oldCap</span>
</div><div style="line-height: 1.6; font-size: 14px;">                            <span style="line-height: 1.6; color: #f92672; font-weight: bold;">else</span> {
</div><div style="line-height: 1.6; font-size: 14px;">                                <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> (hiTail == <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>)
</div><div style="line-height: 1.6; font-size: 14px;">                                    hiHead = e;
</div><div style="line-height: 1.6; font-size: 14px;">                                <span style="line-height: 1.6; color: #f92672; font-weight: bold;">else</span>
</div><div style="line-height: 1.6; font-size: 14px;">                                    hiTail.next = e;
</div><div style="line-height: 1.6; font-size: 14px;">                                hiTail = e;
</div><div style="line-height: 1.6; font-size: 14px;">                            }
</div><div style="line-height: 1.6; font-size: 14px;">                        } <span style="line-height: 1.6; color: #f92672; font-weight: bold;">while</span> ((e = next) != <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>);
</div><div style="line-height: 1.6; font-size: 14px;">                         <span style="line-height: 1.6; color: #888888;">// 原索引放到bucket里</span>
</div><div style="line-height: 1.6; font-size: 14px;">                        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> (loTail != <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>) {
</div><div style="line-height: 1.6; font-size: 14px;">                            loTail.next = <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>;
</div><div style="line-height: 1.6; font-size: 14px;">                            newTab[j] = loHead;
</div><div style="line-height: 1.6; font-size: 14px;">                        }
</div><div style="line-height: 1.6; font-size: 14px;">                        <span style="line-height: 1.6; color: #888888;">// 原索引+oldCap放到bucket里</span>
</div><div style="line-height: 1.6; font-size: 14px;">                        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">if</span> (hiTail != <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>) {
</div><div style="line-height: 1.6; font-size: 14px;">                            hiTail.next = <span style="line-height: 1.6; color: #f92672; font-weight: bold;">null</span>;
</div><div style="line-height: 1.6; font-size: 14px;">                            newTab[j + oldCap] = hiHead;
</div><div style="line-height: 1.6; font-size: 14px;">                        }
</div><div style="line-height: 1.6; font-size: 14px;">                    }
</div><div style="line-height: 1.6; font-size: 14px;">                }
</div><div style="line-height: 1.6; font-size: 14px;">            }
</div><div style="line-height: 1.6; font-size: 14px;">        }
</div><div style="line-height: 1.6; font-size: 14px;">        <span style="line-height: 1.6; color: #f92672; font-weight: bold;">return</span> newTab;
</div><div style="line-height: 1.6; font-size: 14px;">    }
</div></code></pre>
<h1 style="margin: 1.2em 0 .6em 0; font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-size: 36px; font-weight: 400; color: #111111; margin-bottom: 24px; padding: 0;">使用场景</h1>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">HashMap是基于Map接口的实现，用于存储键-值对，它可以接收null的键值，是非同步的， <br/>
HashMap存储着Entry(hash, key, value, next)对象。</p>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">内存缓存</p>
<h1 style="margin: 1.2em 0 .6em 0; font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-size: 36px; font-weight: 400; color: #111111; margin-bottom: 24px; padding: 0;">常见问题</h1>
<h2 style="font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-weight: 400; color: #111111; margin-bottom: 24px; font-size: 24px; margin: 24px 0 6px; padding: 0;">HashMap与Hashtable的区别</h2>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">Hashtable：Hashtable是遗留类，很多映射的常用功能与HashMap类似，不同的是它承自Dictionary类，并且是线程安全的，任一时间只有一个线程能写Hashtable，并发性不如ConcurrentHashMap，因为ConcurrentHashMap引入了分段锁。Hashtable不建议在新代码中使用，不需要线程安全的场合可以用HashMap替换，需要线程安全的场合可以用ConcurrentHashMap替换。</p>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">HashMap 实现了所有map类的方法。并允许使用 null 作为 key 和 value。 <br/>
HashMap和HashTable大致相同。  <br/>
区别在于HashMap不是同步的，并允许null值，HashTable是同步，并且不允许null值。  <br/>
HashMap不保证放入的元素按序存储。同时它也不保证当前的存储顺序会保持很长时间。</p>
<h2 style="font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-weight: 400; color: #111111; margin-bottom: 24px; font-size: 24px; margin: 24px 0 6px; padding: 0;">为什么HashMap的Buckets大小为2的指数？不采样素数？</h2>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">在HashMap中，哈希桶数组table的长度length大小必须为2的n次方(一定是<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">合数</code>)，这是一种非常规的设计， <br/>
常规的设计是把桶的大小设计为素数。相对来说<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">素数导致冲突的概率要小于合数</code>，Hashtable初始化桶大小为11，就是桶大小设计为素数的应用（<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">Hashtable</code>扩容后不能保证还是素数）。</p>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">HashMap采用这种非常规设计，主要是<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">为了在取模和扩容时做优化，同时为了减少冲突</code>， <br/>
HashMap定位哈希桶索引位置时，也加入了<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">高位参与运算</code>的过程。</p>
<h2 style="font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-weight: 400; color: #111111; margin-bottom: 24px; font-size: 24px; margin: 24px 0 6px; padding: 0;">HashMap出现哈希碰撞怎么处理吗？</h2>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">为解决哈希表hash碰撞，可以采用<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">开放地址法</code>和<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">链地址法</code>等来解决问题，Java中HashMap采用了链地址法。</p>
<h3 style="font-family: inherit; margin-top: 21px; margin: 1.2em 0 .6em 0; text-align: start; font-weight: 400; line-height: 1.6; color: #111111; margin-bottom: 24px; font-size: 21px; padding: 0;">链地址法</h3>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">简单来说，就是<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">数组</code>加<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">链表</code>的结合。在每个数组元素上都一个链表结构，当数据被Hash后，得到数组下标，把数据放在对应下标元素的链表上。</p>
<h3 style="font-family: inherit; margin-top: 21px; margin: 1.2em 0 .6em 0; text-align: start; font-weight: 400; line-height: 1.6; color: #111111; margin-bottom: 24px; font-size: 21px; padding: 0;">开放地址法</h3>
<ul style="margin-top: 0; margin-bottom: 1.1em; line-height: 24px; padding: 0; margin: 0; font-size: 16px;"><li style="line-height: 1.6;"><code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">线性开放地址法</code> <br/>
线性开放地址法就是在hash之后，当发现在位置上已经存在了一个变量之后，放到它下一个位置，假如下一个位置也冲突，则继续向下，依次类推，直到找到没有变量的位置，放进去。</li>
<li style="line-height: 1.6;"><code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">平方开放地址法</code> <br/>
平方地址法就是在hash之后，当正确位置上存在冲突，不放到挨着的下一个位置，而是放到第2^0位置，假如继续冲突放到2^1的位置，依次2^3… 直到遇到不冲突的位置放进去。</li>
<li style="line-height: 1.6;"><code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">双散列开放地址法</code> <br/>
双散列同上，不过不是放到2^的位置，而是放到key - hash(key, tablesize)的位置，假如继续冲突，则放到2 (key - hash(key,tablesize))的位置。</li>
</ul>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">如果还是产生了频繁的碰撞，会发生什么问题呢？ <br/>
作者注释说，他们使用树来处理频繁的碰撞(we use trees to handle large sets of collisions in bins)，在JEP-180中，描述了这个问题：</p>
<blockquote style="padding: 15px 20px; margin: 0 0 1.1em; border-left: 5px solid rgba(102,128,153,0.075); border-left-width: 10px; background-color: rgba(102,128,153,0.05); border-top-right-radius: 5px; border-bottom-right-radius: 5px;">
<p style="margin: 0 0 1.1em; font-weight: 300; font-size: 16px; line-height: 24px; margin-bottom: 24px; padding: 0; color: #666;">Improve the performance of java.util.HashMap under <code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">high hash-collision conditions</code> by using <code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">balanced trees</code> rather than <code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">linked lists</code> to store map entries. Implement the same improvement in the LinkedHashMap class.</p>
</blockquote>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">之前已经提过，在获取HashMap的元素时，基本分两步：</p>
<ul style="margin-top: 0; margin-bottom: 1.1em; line-height: 24px; padding: 0; margin: 0; font-size: 16px;"><li style="line-height: 1.6;">首先根据hashCode()做hash，然后确定bucket的index；</li>
<li style="line-height: 1.6;">如果bucket的节点的key不是我们需要的，则通过keys.equals()在链中找。</li>
</ul>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">在<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">Java 8之前</code>的实现中是用链表解决冲突的，在产生碰撞的情况下，进行get时，两步的时间复杂度是<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">O(1)+O(n)</code>，n为bucket.size。因此，当碰撞很厉害的时候n很大，O(n)的速度显然是影响速度的。</p>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">因此在<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">Java 8</code>中，利用<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">红黑树</code>替换链表，这样复杂度就变成了<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">O(1)+O(logn)</code>了，这样在n很大的时候，能够比较理想的解决这个问题，在Java 8：HashMap的性能提升一文中有性能测试的结果。</p>
<h2 style="font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-weight: 400; color: #111111; margin-bottom: 24px; font-size: 24px; margin: 24px 0 6px; padding: 0;">HashMap查询时复杂度一直是O(1)吗？</h2>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">Java8之前，最差是<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">O(1)+O(n/backetSize)</code> <br/>
Java8，复杂度为<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">O(1)+O(log(backetSize))</code></p>
<h2 style="font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-weight: 400; color: #111111; margin-bottom: 24px; font-size: 24px; margin: 24px 0 6px; padding: 0;">你知道HashMap的工作原理吗？</h2>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">通过hash的方法，通过put和get存储和获取对象。</p>
<ul style="margin-top: 0; margin-bottom: 1.1em; line-height: 24px; padding: 0; margin: 0; font-size: 16px;"><li style="line-height: 1.6;">存储对象时(<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">put</code>)，我们将K/V传给put方法，它调用hashCode计算hash从而得到bucket位置，进一步存储，HashMap会根据当前bucket的占用情况自动调整容量(超过Load Facotr则resize为原来的2倍)。</li>
<li style="line-height: 1.6;">获取对象时(<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">get</code>)，我们将K传给get方法，它调用hashCode计算hash从而得到bucket位置，并进一步调用equals()方法确定键值对。如果发生碰撞的时候，Hashmap通过链表将产生碰撞冲突的元素组织起来，在Java 8中，如果一个bucket中碰撞冲突的元素超过某个限制(默认是8)，则使用红黑树来替换链表，从而提高速度。</li>
</ul>
<h2 style="font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-weight: 400; color: #111111; margin-bottom: 24px; font-size: 24px; margin: 24px 0 6px; padding: 0;">你知道get和put的原理吗？equals()和hashCode()的都有什么作用？</h2>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">通过对key的hashCode()进行hashing，并计算下标<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">( n-1 &amp; hash)</code>，从而获得buckets的位置。 <br/>
如果产生碰撞，则利用key.equals()方法去链表或树中去查找对应的节点</p>
<h2 style="font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-weight: 400; color: #111111; margin-bottom: 24px; font-size: 24px; margin: 24px 0 6px; padding: 0;">你知道hash的实现吗？为什么要这样实现？</h2>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">在Java 1.8的实现中，是通过hashCode()的高16位<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">异或</code>低16位实现的：<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">(h = k.hashCode()) ^ (h &gt;&gt;&gt; 16)</code>，主要是从speed、utility、quality来考虑的，这么做可以在bucket的n比较小的时候，也能保证考虑到高低bit都参与到hash的计算中，同时不会有太大的开销。</p>
<h2 style="font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-weight: 400; color: #111111; margin-bottom: 24px; font-size: 24px; margin: 24px 0 6px; padding: 0;">如果HashMap的大小超过了负载因子(load factor)定义的容量，怎么办？</h2>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">如果超过了负载因子(默认0.75)，则会重新resize一个原来长度两倍的HashMap，并且重新调用hash方法。</p>
<h1 style="margin: 1.2em 0 .6em 0; font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-size: 36px; font-weight: 400; color: #111111; margin-bottom: 24px; padding: 0;">基础知识</h1>
<h2 style="font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-weight: 400; color: #111111; margin-bottom: 24px; font-size: 24px; margin: 24px 0 6px; padding: 0;">Java运算符</h2>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;">A = 0011 1100 <br/>
B = 0000 1101 <br/>
<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">＆</code>（位运算）：如果相对应位都是1，则结果为1，否则为0。如<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">A&amp;B</code>=<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">0000 1100</code> <br/>
<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">^</code>（异或运算）：如果相对应位值相同，则结果为0，否则为1。如<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">（A ^ B）</code>=<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">0011 0001</code> <br/>
<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">&gt;&gt;&gt;</code>（按位右移补零操作符）：左操作数的值按右操作数指定的位数右移，移动得到的空位以零填充。如<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">A&gt;&gt;&gt;2</code>=<code style="padding: 2px 4px; color: #c7254e; background-color: #f9f2f4; white-space: normal; border-radius: 4px; font-family: Consolas, Monaco, Andale Mono, monospace; font-size: 13px; line-height: 1.5;">0000 1111</code></p>
<h1 style="margin: 1.2em 0 .6em 0; font-family: inherit; line-height: 1.1; margin-top: 21px; text-align: start; font-size: 36px; font-weight: 400; color: #111111; margin-bottom: 24px; padding: 0;">参考</h1>
<p style="margin: 0 0 1.1em; line-height: 24px; margin-bottom: 24px; padding: 0; font-size: 16px;"><a href="http://yikun.github.io/2015/04/01/Java HashMap工作原理及实现" style="background: transparent; text-decoration: none; color: #0099ff; margin: 0; padding: 0; vertical-align: baseline;" target="_blank">Java HashMap工作原理及实现</a> <br/>
<a href="https://tech.meituan.com/java-hashmap.html" style="background: transparent; text-decoration: none; color: #0099ff; margin: 0; padding: 0; vertical-align: baseline;" target="_blank">Java 8系列之重新认识HashMap</a> <br/>
<a href="http://www.nowamagic.net/academy/detail/3008060" style="background: transparent; text-decoration: none; color: #0099ff; margin: 0; padding: 0; vertical-align: baseline;" target="_blank">散列冲突处理：链地址法</a> <br/>
<a href="https://visualgo.net/en/hashtable" style="background: transparent; text-decoration: none; color: #0099ff; margin: 0; padding: 0; vertical-align: baseline;" target="_blank">HashMap 可视化</a></p></div><center style="display:none">%0A@%2801%u540E%u7AEF%u6280%u672F%29%5BJDK%5D%0A%0A%u4ECEHashMap%u7684%60%u6982%u5FF5%uFF0C%u7ED3%u6784%uFF0C%u53C2%u6570%uFF0C%u6027%u80FD%uFF0C%u7EBF%u7A0B%u5B89%u5168%u6027%uFF0C%u6E90%u7801%u89E3%u6790%uFF08put%2Cget%2Cresize%uFF09%uFF0C%u4F7F%u7528%u573A%u666F%uFF0C%u5E38%u89C1%u95EE%u9898%608%u4E2A%u65B9%u9762%u8FDB%u884C%u5206%u6790%u3002%0A%0A-%20-%20-%0A%3C%21--%20more%20--%3E%20%0A%0A%23%20HashMap%u6DF1%u5165%u89E3%u6790%0A%3EHash%20table%20based%20%60implementation%20of%20the%20Map%20interface%60.%20%0A%3EThis%20implementation%20provides%20all%20of%20the%20optional%20map%20operations%2C%20and%20%60permits%20null%20values%20and%20the%20null%20key.%60%3E%20%28The%20HashMap%20class%20is%20roughly%20equivalent%20to%20Hashtable%2C%20except%20that%20it%20is%20%60unsynchronized%60%20and%20permits%20nulls.%29%20%0A%3E%20This%20class%20makes%20%60no%20guarantees%20as%20to%20the%20order%20of%20the%20map%60%3B%20in%20particular%2C%20it%20%60does%20not%20guarantee%20that%20the%20order%20will%20remain%20constant%20over%20time%60.%0A%0A%u5173%u952E%u70B9%uFF1AMap%u63A5%u53E3%u7684%u5B9E%u73B0%u3001%u5141%u8BB8null%u952E/%u503C%u3001%u975E%u540C%u6B65%u3001%u4E0D%u4FDD%u8BC1%u6709%u5E8F%28%u6BD4%u5982%u63D2%u5165%u7684%u987A%u5E8F%29%u3001%u4E0D%u4FDD%u8BC1%u987A%u5E8F%u4E0D%u968F%u65F6%u95F4%u53D8%u5316%u3002%0A%60%60%60java%0AHashMap%3CString%2C%20Integer%3E%20map%20%3D%20new%20HashMap%3CString%2C%20Integer%3E%28%29%3B%0Amap.put%28%22%u8BED%u6587%22%2C%201%29%3B%0Amap.put%28%22%u6570%u5B66%22%2C%202%29%3B%0Amap.put%28%22%u82F1%u8BED%22%2C%203%29%3B%0Amap.put%28%22%u5386%u53F2%22%2C%204%29%3B%0Amap.put%28%22%u653F%u6CBB%22%2C%205%29%3B%0Amap.put%28%22%u5730%u7406%22%2C%206%29%3B%0Amap.put%28%22%u751F%u7269%22%2C%207%29%3B%0Amap.put%28%22%u5316%u5B66%22%2C%208%29%3B%0Afor%28Entry%3CString%2C%20Integer%3E%20entry%20%3A%20map.entrySet%28%29%29%20%7B%0A%20%20%20%20System.out.println%28entry.getKey%28%29%20+%20%22%3A%20%22%20+%20entry.getValue%28%29%29%3B%0A%7D%0A%60%60%60%0A%21%5Bhashmap%u793A%u4F8B%5D%28./1506490529273.png%29%0A%0A%23%20HashMap%u7ED3%u6784%0A%u4ECE%u7ED3%u6784%u5B9E%u73B0%u6765%u8BB2%uFF0CHashMap%u662F%u6570%u7EC4+%u94FE%u8868+%u7EA2%u9ED1%u6811%uFF08JDK1.8%u589E%u52A0%u4E86%u7EA2%u9ED1%u6811%u90E8%u5206%uFF09%u5B9E%u73B0%u7684%uFF0C%u5982%u4E0B%u5982%u6240%u793A%u3002%0A%21%5BHashMap%u7ED3%u6784%5D%28./1506578135195.png%29%0A*%20HashMap%u7C7B%u4E2D%u6709%u4E00%u4E2A%u975E%u5E38%u91CD%u8981%u7684%u5B57%u6BB5%uFF0C%u5C31%u662F%20%60Node%5B%5D%20table%60%uFF0C%u5373%u54C8%u5E0C%u6876%u6570%u7EC4%u3002Node%u662FHashMap%u7684%u4E00%u4E2A%u5185%u90E8%u7C7B%uFF0C%u5B9E%u73B0%u4E86Map.Entry%u63A5%u53E3%uFF0C%u672C%u8D28%u662F%u5C31%u662F%u4E00%u4E2A%u6620%u5C04%28%u952E%u503C%u5BF9%29%u3002%u4E0A%u56FE%u4E2D%u7684%u6BCF%u4E2A%u9ED1%u8272%u5706%u70B9%u5C31%u662F%u4E00%u4E2ANode%u5BF9%u8C61%u3002%0A%20%0A%21%5Bhashmap%u7C7B%u56FE%5D%28./1506499700918.png%29%0A*%20%u62BD%u8C61%u7C7B%uFF1AAbstractMap%0A*%20%u63A5%u53E3%uFF1AMap%0A*%20%u5B9E%u4F53%uFF1AEntrySet%u3001KeySet%u3001Node%u3001TreeNode%u3001Values%0A%0A*%20%u8FED%u4EE3%u5668%0AEntryIterator%u3001HashIterator%u3001KeyIterator%u3001ValueIterator%0A%0A*%20%u5206%u5272%u5668%0ASpliterator%u3001EntrySpliterator%u3001HashMapSpliterator%u3001KeySpliterator%u3001ValueSpliterator%0A%0A%23%20HashMap%u53C2%u6570%0A%u5728HashMap%u4E2D%u67092%u4E2A%u91CD%u8981%u53C2%u6570%uFF0C%20Capacity%u548CLoad%20factor%0A%23%23%20Capacity%uFF08%u5BB9%u91CF%uFF09%0A%3EThe%20capacity%20is%20the%20%60number%20of%20buckets%60%20in%20the%20hash%20table%2C%20The%20initial%20capacity%20is%20simply%20the%20capacity%20at%20the%20time%20the%20hash%20table%20is%20created.%0A%60Capacity%60%u5C31%u662Fbuckets%u7684%u6570%u76EE%uFF0C%u9ED8%u8BA4%u503C%u4E3A16%u3002%0A%0A%23%23%20Load%20factor%uFF08%u8D1F%u8F7D%u56E0%u5B50%uFF09%0A%3EThe%20load%20factor%20is%20a%20measure%20of%20how%20full%20the%20hash%20table%20is%20allowed%20to%20get%20before%20its%20capacity%20is%20automatically%20increased.%0A%0A%60Load%20factor%60%u662Fbuckets%u586B%u6EE1%u7A0B%u5EA6%u7684%u6700%u5927%u6BD4%u4F8B%uFF0C%u9ED8%u8BA4%u503C%u4E3A0.75%uFF0C%u5F53%60bucket%60%u586B%u5145%u7684%u6570%u76EE%uFF08%u5373hashmap%u4E2D%u5143%u7D20%u7684%u4E2A%u6570%uFF09%u5927%u4E8E%24capacity%20*%20load%20factor%24%u65F6%u5C31%u9700%u8981%u8C03%u6574buckets%u7684%u6570%u76EE%u4E3A%u5F53%u524D%u76842%u500D%u3002%0A%0A%23%20HashMap%u6027%u80FD%0A%u5F53%u524D%u5B9E%u73B0%u7684HashMap%u5B9E%u73B0%u63D0%u4F9B%u4E86%60constant-time%60%u7684%u65B9%u6CD5%u6765%u8FDB%u884Cget%2C%20put%20%u7B49%u57FA%u672C%u64CD%u4F5C%u3002%0A*%20%u5982%u679Ckey%u7ECF%u8FC7hash%u7B97%u6CD5%u5F97%u51FA%u7684%u6570%u7EC4%u7D22%u5F15%u4F4D%u7F6E%u5168%u90E8%u4E0D%u76F8%u540C%uFF0C%u5373Hash%u7B97%u6CD5%u975E%u5E38%u597D%uFF0C%u90A3%u6837%u7684%u8BDD%uFF0CgetKey%u65B9%u6CD5%u7684%u65F6%u95F4%u590D%u6742%u5EA6%u5C31%u662F%60O%281%29%60%uFF0C%0A*%20%u5982%u679CHash%u7B97%u6CD5%u6280%u672F%u7684%u7ED3%u679C%u78B0%u649E%u975E%u5E38%u591A%uFF0C%u5047%u5982Hash%u7B97%u6781%u5176%u5DEE%uFF0C%u6240%u6709%u7684Hash%u7B97%u6CD5%u7ED3%u679C%u5F97%u51FA%u7684%u7D22%u5F15%u4F4D%u7F6E%u4E00%u6837%uFF0C%u90A3%u6837%u6240%u6709%u7684%u952E%u503C%u5BF9%u90FD%u96C6%u4E2D%u5230%u4E00%u4E2A%u6876%u4E2D%uFF0C%u6216%u8005%u5728%u4E00%u4E2A%u94FE%u8868%u4E2D%uFF0C%u6216%u8005%u5728%u4E00%u4E2A%u7EA2%u9ED1%u6811%u4E2D%uFF0C%u65F6%u95F4%u590D%u6742%u5EA6%u5206%u522B%u4E3A%60O%28n%29%60%u548C%60O%28lgn%29%60%u3002%0A%0A%23%23%20%u51E0%u4E2A%u8981%u6CE8%u610F%u7684%u6027%u80FD%u70B9%uFF08%u7A7A%u95F4/%u65F6%u95F4%u7684tradeoff%uFF09%0A1.%20%u5047%u5982%u54C8%u5E0C%u51FD%u6570%u80FD%u591F%u5C06%u5143%u7D20%u5206%u6563%u5230%u6240%u6709%u7684buckets%u91CC%u3002%u4ECECollection%u7684%u89D2%u5EA6%u6765%u8BF4%uFF0C%u904D%u5386HashMap%u9700%u8981%u7684%u65F6%u95F4%u4E3A%60count%28buckets%29+count%28bucket.entrySize%29%60%u3002%u5982%u679C%u904D%u5386%u9891%u7E41/%u5BF9%u8FED%u4EE3%u6027%u80FD%u8981%u6C42%u5F88%u9AD8%uFF0C%u4E0D%u8981%u628A%60capacity%60%u8BBE%u7F6E%u8FC7%u5927%uFF0C%u4E5F%u4E0D%u8981%u628A%60load%20factor%60%u8BBE%u7F6E%u8FC7%u5C0F%uFF1B%60load%20factor%60%u66F4%u5927%u4F1A%u51CF%u5C11%u7A7A%u95F4%u6D88%u8017%uFF0C%u66F4%u5C0F%u4F1A%u589E%u52A0%u65F6%u95F4%u6D88%u8017%uFF08%u67E5%u627E%u66F4%u8D39%u65F6%uFF09%u3002%0A2.%20%u6269%u5BB9%u662F%u4E00%u4E2A%u7279%u522B%u8017%u6027%u80FD%u7684%u64CD%u4F5C%uFF0C%u5982%u679C%u5F88%u591Akey-values%u5BF9%u5B58%u50A8%u5728%20HashMap%20%u5B9E%u4F8B%u4E2D%uFF0C%u7ED9%u4ED6%60%u521D%u59CB%u5316%u4E00%u4E2A%u8DB3%u591F%u5927%u7684capacity%60%20%uFF0C%u907F%u514Dmap%u8FDB%u884C%u9891%u7E41%u7684resize%u6269%u5BB9%u3002%u8FD9%u6837%u66F4%u6709%u6548%u7387%u3002%0A3.%20%u9ED8%u8BA4%u7684%60load%20factor%3D0.75%60%u662F%u5BF9%u7A7A%u95F4%u548C%u65F6%u95F4%u6548%u7387%u7684%u4E00%u4E2A%60%u5E73%u8861%u9009%u62E9%60%uFF0C%u5EFA%u8BAE%u4E0D%u8981%u4FEE%u6539%uFF0C%u9664%u975E%u5728%u65F6%u95F4%u548C%u7A7A%u95F4%u6BD4%u8F83%u7279%u6B8A%u7684%u60C5%u51B5%u4E0B%uFF0C%u5982%u679C%u5185%u5B58%u7A7A%u95F4%u5F88%u591A%u800C%u53C8%u5BF9%u65F6%u95F4%u6548%u7387%u8981%u6C42%u5F88%u9AD8%uFF0C%u53EF%u4EE5%u964D%u4F4E%u8D1F%u8F7D%u56E0%u5B50Load%20factor%u7684%u503C%uFF1B%u76F8%u53CD%uFF0C%u5982%u679C%u5185%u5B58%u7A7A%u95F4%u7D27%u5F20%u800C%u5BF9%u65F6%u95F4%u6548%u7387%u8981%u6C42%u4E0D%u9AD8%uFF0C%u53EF%u4EE5%u589E%u52A0%u8D1F%u8F7D%u56E0%u5B50loadFactor%u7684%u503C%uFF0C%u8FD9%u4E2A%u503C%u53EF%u4EE5%u5927%u4E8E1%u3002%0A%0A%23%20HashMap%u7EBF%u7A0B%u5B89%u5168%u6027%0A%0A%23%23%20HashMap%u4E3A%u4EC0%u4E48%u7EBF%u7A0B%u4E0D%u5B89%u5168%0A%u4E3A%u4EC0%u4E48HashMap%u662F%u7EBF%u7A0B%u4E0D%u5B89%u5168%u7684%uFF1F%0A1.%20%60%u591A%u7EBF%u7A0Bput-%u54C8%u5E0C%u78B0%u649E%u95EE%u9898%60%uFF1A%u5982%u679C%u591A%u4E2A%u7EBF%u7A0B%u540C%u65F6%u4F7F%u7528put%u65B9%u6CD5%u6DFB%u52A0%u5143%u7D20%uFF0C%u800C%u4E14%u5047%u8BBE%u6B63%u597D%u5B58%u5728%u4E24%u4E2A%20put%20%u7684%20key%20%u53D1%u751F%u4E86%u78B0%u649E%28%u6839%u636E%20hash%20%u503C%u8BA1%u7B97%u7684%20bucket%20%u4E00%u6837%29%uFF0C%u90A3%u4E48%u6839%u636E%20HashMap%20%u7684%u5B9E%u73B0%uFF0C%u8FD9%u4E24%u4E2A%20key%20%u4F1A%u6DFB%u52A0%u5230%u6570%u7EC4%u7684%u540C%u4E00%u4E2A%u4F4D%u7F6E%uFF0C%u8FD9%u6837%u6700%u7EC8%u5C31%u4F1A%u53D1%u751F%u5176%u4E2D%u4E00%u4E2A%u7EBF%u7A0B%u7684%20put%20%u7684%u6570%u636E%u88AB%u8986%u76D6%uFF1B%0A2.%20%60%u591A%u7EBF%u7A0Bput-%u6B7B%u5FAA%u73AF%u95EE%u9898%60%uFF1AashMap%20%u5728%u5E76%u53D1%u6267%u884C%20put%20%u64CD%u4F5C%u65F6%u4F1A%u5F15%u8D77%u6B7B%u5FAA%u73AF%uFF0C%u5BFC%u81F4%20CPU%20%u5229%u7528%u7387%u63A5%u8FD1100%25%u3002%u56E0%u4E3A%u591A%u7EBF%u7A0B%u4F1A%u5BFC%u81F4%20HashMap%20%u7684%20Node%20%u94FE%u8868%u5F62%u6210%u73AF%u5F62%u6570%u636E%u7ED3%u6784%uFF0C%u4E00%u65E6%u5F62%u6210%u73AF%u5F62%u6570%u636E%u7ED3%u6784%uFF0CNode%20%u7684%20next%20%u8282%u70B9%u6C38%u8FDC%u4E0D%u4E3A%u7A7A%uFF0C%u5C31%u4F1A%u5728%u83B7%u53D6%20Node%20%u65F6%u4EA7%u751F%u6B7B%u5FAA%u73AF%u3002-%u300AJava%u5E76%u53D1%u7F16%u7A0B%u7684%u827A%u672F%u300B%0A3.%20%60%u591A%u7EBF%u7A0Bresize-%u6570%u636E%u4E22%u5931%u95EE%u9898%60%uFF1A%u5982%u679C%u591A%u4E2A%u7EBF%u7A0B%u540C%u65F6%u68C0%u6D4B%u5230%u5143%u7D20%u4E2A%u6570%u8D85%u8FC7%60table%20size*%20loadFactor%60%20%uFF0C%u8FD9%u6837%u5C31%u4F1A%u53D1%u751F%u591A%u4E2A%u7EBF%u7A0B%u540C%u65F6%u5BF9%20Node%20%u6570%u7EC4%u8FDB%u884C%u6269%u5BB9%uFF0C%u90FD%u5728%u91CD%u65B0%u8BA1%u7B97%u5143%u7D20%u4F4D%u7F6E%u4EE5%u53CA%u590D%u5236%u6570%u636E%uFF0C%u4F46%u662F%u6700%u7EC8%u53EA%u6709%u4E00%u4E2A%u7EBF%u7A0B%u6269%u5BB9%u540E%u7684%u6570%u7EC4%u4F1A%u8D4B%u7ED9%20table%uFF0C%u4E5F%u5C31%u662F%u8BF4%u5176%u4ED6%u7EBF%u7A0B%u7684%u90FD%u4F1A%u4E22%u5931%uFF0C%u5E76%u4E14%u5404%u81EA%u7EBF%u7A0B%20put%20%u7684%u6570%u636E%u4E5F%u4E22%u5931%uFF1B%0A%0A%23%23%20HashMap%u7EBF%u7A0B%u5B89%u5168%u521D%u59CB%u5316%0A%u5728%u591A%u7EBF%u7A0B%u4F7F%u7528%u573A%u666F%u4E2D%uFF0C%u5E94%u8BE5%u5C3D%u91CF%u907F%u514D%u4F7F%u7528%u7EBF%u7A0B%u4E0D%u5B89%u5168%u7684%60HashMap%60%uFF0C%u53EF%u7528%u4EE5%u4E0B2%u79CD%u65B9%u5F0F%u5B9E%u73B0%u7EBF%u7A0B%u5B89%u5168%uFF1A%0A1.%20ConcurrentHashMap%uFF1A%20%60Map%20map%20%3D%20new%20ConcurrentHashMap%3CString%2C%20Object%3E%28%29%3B%60%0A2.%20Collections.synchronizedMap%uFF1A%60Map%20map%20%3D%20Collections.synchronizedMap%28new%20HashMap%3CString%2C%20Object%3E%28%29%29%3B%60%0A%0A%23%20HashMap%u6E90%u7801%u89E3%u6790%0A%23%23%20hashcode%u65B9%u6CD5%0A%60%60%60java%0Astatic%20final%20int%20hash%28Object%20key%29%20%7B%0A%20%20%20%20int%20h%3B%0A%20%20%20%20//%u6270%u52A8%u51FD%u6570%0A%20%20%20%20return%20%28key%20%3D%3D%20null%29%20%3F%200%20%3A%20%28h%20%3D%20key.hashCode%28%29%29%20%5E%20%28h%20%3E%3E%3E%2016%29%3B%0A%7D%0A%60%60%60%0A%21%5Bhashcode%u65B9%u6CD5%5D%28./1506556253947.png%29%0A%3E%u6270%u52A8%u51FD%u6570%uFF1A%u53F3%u4F4D%u79FB16%u4F4D%uFF0C%u6B63%u597D%u662F32bit%u7684%u4E00%u534A%uFF0C%u81EA%u5DF1%u7684%u9AD8%u534A%u533A%u548C%u4F4E%u534A%u533A%u505A%u5F02%u6216%uFF0C%u5C31%u662F%u4E3A%u4E86%60%u6DF7%u5408%u539F%u59CB%u54C8%u5E0C%u7801%u7684%u9AD8%u4F4D%u548C%u4F4E%u4F4D%60%uFF0C%u4EE5%u6B64%u6765%u52A0%u5927%u4F4E%u4F4D%u7684%u968F%u673A%u6027%u3002%u800C%u4E14%u6DF7%u5408%u540E%u7684%u4F4E%u4F4D%u63BA%u6742%u4E86%u9AD8%u4F4D%u7684%u90E8%u5206%u7279%u5F81%uFF0C%u8FD9%u6837%u9AD8%u4F4D%u7684%u4FE1%u606F%u4E5F%u88AB%u53D8%u76F8%u4FDD%u7559%u4E0B%u6765%u3002%0A%0A%3EComputes%20key.hashCode%28%29%20and%20%60spreads%20%28XORs%29%20higher%20bits%20of%20hash%20to%20lower.%60%20Because%20the%20table%20uses%20power-of-two%20masking%2C%20sets%20of%20hashes%20that%20vary%20only%20in%20bits%20above%20the%20current%20mask%20will%20always%20collide.%20%28Among%20known%20examples%20are%20sets%20of%20Float%20keys%20holding%20consecutive%20whole%20numbers%20in%20small%20tables.%29%20So%20we%20apply%20a%20transform%20that%20%60spreads%20the%20impact%20of%20higher%20bits%20downward%60.%20There%20is%20a%20%60tradeoff%60%20between%20%60speed%2C%20utility%2C%20and%20quality%20of%20bit-spreading%60.%20Because%20many%20common%20sets%20of%20hashes%20are%20already%20%60reasonably%20distributed%60%20%28so%20don%u2019t%20benefit%20from%20spreading%29%2C%20and%20because%20we%20%60use%20trees%20to%20handle%20large%20sets%20of%20collisions%20in%20bins%60%2C%20we%20just%20XOR%20some%20shifted%20bits%20in%20the%20cheapest%20possible%20way%20to%20reduce%20systematic%20lossage%2C%20as%20well%20as%20to%20incorporate%20impact%20of%20the%20highest%20bits%20that%20would%20otherwise%20never%20be%20used%20in%20index%20calculations%20because%20of%20table%20bounds.%0A%0A%u5728%u8BBE%u8BA1hash%u51FD%u6570%u65F6%uFF0C%u56E0%u4E3A%u76EE%u524D%u7684table%u957F%u5EA6n%u4E3A2%u7684%u5E42%uFF0C%u800C%u8BA1%u7B97%u4E0B%u6807%u7684%u65F6%u5019%uFF0C%u662F%u8FD9%u6837%u5B9E%u73B0%u7684%28%u4F7F%u7528%60%26%60%u4F4D%u64CD%u4F5C%uFF0C%u800C%u975E%60%25%60%u6C42%u4F59%29%uFF1A%0A%60%60%60java%0A%28n%20-%201%29%20%26%20hash%0A%60%60%60%0A%u8BBE%u8BA1%u8005%u8BA4%u4E3A%u8FD9%u65B9%u6CD5%u5F88%u5BB9%u6613%u53D1%u751F%u78B0%u649E%u3002%u4E3A%u4EC0%u4E48%u8FD9%u4E48%u8BF4%u5462%uFF1F%u4E0D%u59A8%u601D%u8003%u4E00%u4E0B%uFF0C%u5728n%20-%201%u4E3A15%28%600000000000000000%200000000000001111%60%29%u65F6%uFF0C%u5176%u5B9E%u6563%u5217%u771F%u6B63%u751F%u6548%u7684%u53EA%u662F%u4F4E4bit%u7684%u6709%u6548%u4F4D%uFF0C%u5F53%u7136%u5BB9%u6613%u78B0%u649E%u4E86%u3002%0A%20%0A%u56E0%u6B64%uFF0C%u8BBE%u8BA1%u8005%u60F3%u4E86%u4E00%u4E2A%u987E%u5168%u5927%u5C40%u7684%u65B9%u6CD5%28%u7EFC%u5408%u8003%u8651%u4E86%60%u901F%u5EA6%u3001%u4F5C%u7528%u3001%u8D28%u91CF%60%29%uFF0C%u5C31%u662F%u628A%u9AD816bit%u548C%u4F4E16bit%u8FDB%u884C%u5F02%u6216%u8FD0%u7B97%u3002%u8BBE%u8BA1%u8005%u8FD8%u89E3%u91CA%u5230%u56E0%u4E3A%u73B0%u5728%u5927%u591A%u6570%u7684hashCode%u7684%u5206%u5E03%u5DF2%u7ECF%u5F88%u4E0D%u9519%u4E86%uFF0C%u5C31%u7B97%u662F%u53D1%u751F%u4E86%u78B0%u649E%u4E5F%u7528%60O%28log_n%29%60%u7684tree%u53BB%u505A%u4E86%u3002%0A%u4EC5%u4EC5%u5F02%u6216%u8FD0%u7B97%uFF0C%u65E2%u51CF%u5C11%u4E86%u7CFB%u7EDF%u7684%u5F00%u9500%uFF0C%u4E5F%u4E0D%u4F1A%u9020%u6210%u7684%u56E0%u4E3A%u9AD8%u4F4D%u6CA1%u6709%u53C2%u4E0E%u4E0B%u6807%u7684%u8BA1%u7B97%28table%u957F%u5EA6%u6BD4%u8F83%u5C0F%u65F6%29%uFF0C%u4ECE%u800C%u5F15%u8D77%u7684%u78B0%u649E%u3002%0A%0A%23%23%20put%u65B9%u6CD5%0A%21%5BHashMap%u4E4Bput%u65B9%u6CD5%5D%28./1506579984225.png%29%0A%0A%60%60%60java%0A%09public%20V%20put%28K%20key%2C%20V%20value%29%20%7B%0A%09%09//%u5BF9key%u7684hashCode%u8FDB%u884C16%u4F4D%u5F02%u6216%u6DF7%u5408%0A%09%20%20%20%20return%20putVal%28hash%28key%29%2C%20key%2C%20value%2C%20false%2C%20true%29%3B%0A%09%7D%0A%09%0A%20%20%20%20/**%0A%20%20%20%20%20*%20Implements%20Map.put%20and%20related%20methods%0A%20%20%20%20%20*/%0A%20%20%20%20final%20V%20putVal%28int%20hash%2C%20K%20key%2C%20V%20value%2C%20boolean%20onlyIfAbsent%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20boolean%20evict%29%20%7B%0A%20%20%20%20%20%20%20%20Node%3CK%2CV%3E%5B%5D%20tab%3B%20%0A%20%20%20%20%20%20%20%20Node%3CK%2CV%3E%20p%3B%20%0A%20%20%20%20%20%20%20%20//n%u4E3Ahashtable%u7684%u957F%u5EA6%uFF0Ci%u4E3A%0A%20%20%20%20%20%20%20%20int%20n%2C%20i%3B%0A%20%20%20%20%20%20%20%20//%20tab%u4E3A%u7A7A%u5219%u521D%u59CB%u5316table%0A%20%20%20%20%20%20%20%20if%20%28%28tab%20%3D%20table%29%20%3D%3D%20null%20%7C%7C%20%28n%20%3D%20tab.length%29%20%3D%3D%200%29%0A%20%20%20%20%20%20%20%20%20%20%20%20n%20%3D%20%28tab%20%3D%20resize%28%29%29.length%3B%0A%20%20%20%20%20%20%20%20//%u8BA1%u7B97table%u6570%u7EC4%u4E0B%u6807%uFF0C%u4F4D%u8FD0%u7B97%uFF1A%28n-1%29%26hash%uFF1B%u82E5%u8BE5%u4E0B%u6807%u4E0D%u4E3Anull%u5219%u65B0%u589ENode%0A%20%20%20%20%20%20%20%20if%20%28%28p%20%3D%20tab%5Bi%20%3D%20%28n%20-%201%29%20%26%20hash%5D%29%20%3D%3D%20null%29%0A%20%20%20%20%20%20%20%20%20%20%20%20tab%5Bi%5D%20%3D%20newNode%28hash%2C%20key%2C%20value%2C%20null%29%3B%0A%20%20%20%20%20%20%20%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20Node%3CK%2CV%3E%20e%3B%20K%20k%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20//%u8282%u70B9%u5B58%u5728%uFF1Akey%u54C8%u5E0C%u503C%u4E00%u81F4%20%uFF0Ckey%u7684%u5185%u5B58%u5730%u5740%u4E00%u81F4%20%7C%7C%20key%u4E0D%u4E3Anull%20%26%20%u5B9E%u9645%u5B9E%u4F53%u4E00%u81F4%uFF0C%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28p.hash%20%3D%3D%20hash%20%26%26%20%28%28k%20%3D%20p.key%29%20%3D%3D%20key%20%7C%7C%20%28key%20%21%3D%20null%20%26%26%20key.equals%28k%29%29%29%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e%20%3D%20p%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%u8BE5%u94FE%u4E3A%u7EA2%u9ED1%u6811%0A%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20%28p%20instanceof%20TreeNode%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e%20%3D%20%28%28TreeNode%3CK%2CV%3E%29p%29.putTreeVal%28this%2C%20tab%2C%20hash%2C%20key%2C%20value%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20//%20%u8BE5%u94FE%u4E3A%u94FE%u8868%0A%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20for%20%28int%20binCount%20%3D%200%3B%20%3B%20++binCount%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28%28e%20%3D%20p.next%29%20%3D%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20p.next%20%3D%20newNode%28hash%2C%20key%2C%20value%2C%20null%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%u94FE%u8868%u957F%u5EA6%u5927%u4E8E8%u8F6C%u6362%u4E3A%u7EA2%u9ED1%u6811%u8FDB%u884C%u5904%u7406%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28binCount%20%3E%3D%20TREEIFY_THRESHOLD%20-%201%29%20//%20-1%20for%201st%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20treeifyBin%28tab%2C%20hash%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20key%u5DF2%u7ECF%u5B58%u5728%u76F4%u63A5%u8986%u76D6value%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28e.hash%20%3D%3D%20hash%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%28%28k%20%3D%20e.key%29%20%3D%3D%20key%20%7C%7C%20%28key%20%21%3D%20null%20%26%26%20key.equals%28k%29%29%29%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20break%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20p%20%3D%20e%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28e%20%21%3D%20null%29%20%7B%20//%20existing%20mapping%20for%20key%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20V%20oldValue%20%3D%20e.value%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28%21onlyIfAbsent%20%7C%7C%20oldValue%20%3D%3D%20null%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e.value%20%3D%20value%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20afterNodeAccess%28e%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20oldValue%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20++modCount%3B%0A%20%20%20%20%20%20%20%20//%u8D85%u8FC7%u6700%u5927%u5BB9%u91CF%uFF08load%20factor*current%20capacity%uFF09%uFF0C%u5C31%u6269%u5BB9%0A%20%20%20%20%20%20%20%20if%20%28++size%20%3E%20threshold%29%0A%20%20%20%20%20%20%20%20%20%20%20%20resize%28%29%3B%0A%20%20%20%20%20%20%20%20afterNodeInsertion%28evict%29%3B%0A%20%20%20%20%20%20%20%20return%20null%3B%0A%20%20%20%20%7D%0A%60%60%60%0A%0A%23%23%20get%u65B9%u6CD5%0Aget%u5927%u81F4%u601D%u8DEF%u5982%u4E0B%uFF1A%0A*%20bucket%u91CC%u7684%u7B2C%u4E00%u4E2A%u8282%u70B9%uFF0C%u76F4%u63A5%u547D%u4E2D%uFF1B%0A*%20%u5982%u679C%u6709%u51B2%u7A81%uFF0C%u5219%u901A%u8FC7key.equals%28k%29%u53BB%u67E5%u627E%u5BF9%u5E94%u7684entry%0A*%20%u82E5%u4E3A%u6811%uFF0C%u5219%u5728%u6811%u4E2D%u901A%u8FC7key.equals%28k%29%u67E5%u627E%uFF0CO%28logn%29%uFF1B%0A*%20%u82E5%u4E3A%u94FE%u8868%uFF0C%u5219%u5728%u94FE%u8868%u4E2D%u901A%u8FC7key.equals%28k%29%u67E5%u627E%uFF0CO%28n%29%u3002%0A%u5177%u4F53%u4EE3%u7801%u7684%u5B9E%u73B0%u5982%u4E0B%uFF1A%0A%60%60%60java%0A%20%20%20%20public%20V%20get%28Object%20key%29%20%7B%0A%20%20%20%20%20%20%20%20Node%3CK%2CV%3E%20e%3B%0A%20%20%20%20%20%20%20%20return%20%28e%20%3D%20getNode%28hash%28key%29%2C%20key%29%29%20%3D%3D%20null%20%3F%20null%20%3A%20e.value%3B%0A%20%20%20%20%7D%0A%0A%20%20%20%20/**%0A%20%20%20%20%20*%20Implements%20Map.get%20and%20related%20methods%0A%20%20%20%20%20*/%0A%20%20%20%20final%20Node%3CK%2CV%3E%20getNode%28int%20hash%2C%20Object%20key%29%20%7B%0A%20%20%20%20%20%20%20%20Node%3CK%2CV%3E%5B%5D%20tab%3B%20Node%3CK%2CV%3E%20first%2C%20e%3B%20int%20n%3B%20K%20k%3B%0A%20%20%20%20%20%20%20%20if%20%28%28tab%20%3D%20table%29%20%21%3D%20null%20%26%26%20%28n%20%3D%20tab.length%29%20%3E%200%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%28first%20%3D%20tab%5B%28n%20-%201%29%20%26%20hash%5D%29%20%21%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28first.hash%20%3D%3D%20hash%20%26%26%20//%20always%20check%20first%20node%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%28%28k%20%3D%20first.key%29%20%3D%3D%20key%20%7C%7C%20%28key%20%21%3D%20null%20%26%26%20key.equals%28k%29%29%29%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20first%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28%28e%20%3D%20first.next%29%20%21%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28first%20instanceof%20TreeNode%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20%28%28TreeNode%3CK%2CV%3E%29first%29.getTreeNode%28hash%2C%20key%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20do%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28e.hash%20%3D%3D%20hash%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%28%28k%20%3D%20e.key%29%20%3D%3D%20key%20%7C%7C%20%28key%20%21%3D%20null%20%26%26%20key.equals%28k%29%29%29%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20e%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20while%20%28%28e%20%3D%20e.next%29%20%21%3D%20null%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20return%20null%3B%0A%20%20%20%20%7D%0A%60%60%60%0A%0A%23%23%20resize%u65B9%u6CD5%0A%u5F53put%u65F6%uFF0C%u5982%u679C%u53D1%u73B0%u76EE%u524D%u7684bucket%u5360%u7528%u7A0B%u5EA6%u5DF2%u7ECF%u8D85%u8FC7%u4E86Load%20Factor%u6240%u5E0C%u671B%u7684%u6BD4%u4F8B%uFF0C%u90A3%u4E48%u5C31%u4F1A%u53D1%u751Fresize%u3002%0A%3E%u5982%u679C%u4E0D%u8FDB%u884Cresize%u6269%u5BB9%uFF0C%u5355%u4E2A%u94FE%u8868%u4E2D%u7684%u6570%u636E%u8FC7%u591A%uFF0Cget%28%29%2Cput%28%29%2Cremove%28%29%u7B49%u65B9%u6CD5%u6548%u7387%u90FD%u4F1A%u964D%u4F4E%u3002%0A%0A%u5728resize%u7684%u8FC7%u7A0B%uFF0C%u7B80%u5355%u7684%u8BF4%u5C31%u662F%u628Abucket%u6269%u5145%u4E3A2%u500D%uFF0C%u4E4B%u540E%u91CD%u65B0%u8BA1%u7B97index%uFF0C%u628A%u8282%u70B9%u518D%u653E%u5230%u65B0%u7684bucket%u4E2D%u3002resize%u7684%u6CE8%u91CA%u662F%u8FD9%u6837%u63CF%u8FF0%u7684%uFF1A%0A%3EInitializes%20or%20doubles%20table%20size.%20If%20null%2C%20allocates%20in%20accord%20with%20initial%20capacity%20target%20held%20in%20field%20threshold.%20Otherwise%2C%20because%20we%20are%20using%20%60power-of-two%20expansion%60%2C%20the%20elements%20from%20each%20bin%20must%20either%20stay%20at%20same%20index%2C%20or%20move%20with%20a%20power%20of%20%60two%20offset%60%20in%20the%20new%20table.%0A%u5927%u81F4%u610F%u601D%u5C31%u662F%u8BF4%uFF0C%u5F53%u8D85%u8FC7%u9650%u5236%u7684%u65F6%u5019%u4F1Aresize%uFF0C%u7136%u800C%u53C8%u56E0%u4E3A%u6211%u4EEC%u4F7F%u7528%u7684%u662F%602%u6B21%u5E42%60%u7684%u6269%u5C55%28%u6307%u957F%u5EA6%u6269%u4E3A%u539F%u67652%u500D%29%uFF0C%u6240%u4EE5%uFF0C%u5143%u7D20%u7684%u4F4D%u7F6E%u8981%u4E48%u662F%u5728%u539F%u4F4D%u7F6E%uFF0C%u8981%u4E48%u662F%u5728%u539F%u4F4D%u7F6E%u518D%u79FB%u52A82%u6B21%u5E42%u7684%u4F4D%u7F6E%u3002%0A%0A%u600E%u4E48%u7406%u89E3%u5462%uFF1F%u4F8B%u5982%u6211%u4EEC%u4ECE16%u6269%u5C55%u4E3A32%u65F6%uFF0C%u5177%u4F53%u7684%u53D8%u5316%u5982%u4E0B%u6240%u793A%uFF1A%0A%21%5Bhash%5D%28./1506580586999.png%29%0A%u56E0%u6B64%u5143%u7D20%u5728%u91CD%u65B0%u8BA1%u7B97hash%u4E4B%u540E%uFF0C%u56E0%u4E3An%u53D8%u4E3A2%u500D%uFF0C%u90A3%u4E48n-1%u7684mask%u8303%u56F4%u5728%u9AD8%u4F4D%u591A1bit%28%u7EA2%u8272%29%uFF0C%u56E0%u6B64%u65B0%u7684index%u5C31%u4F1A%u53D1%u751F%u8FD9%u6837%u7684%u53D8%u5316%uFF1A%0A%21%5Bresize%5D%28./1506567517084.png%29%0A%u56E0%u6B64%uFF0C%u6211%u4EEC%u5728%u6269%u5145HashMap%u7684%u65F6%u5019%uFF0C%u4E0D%u9700%u8981%u91CD%u65B0%u8BA1%u7B97hash%uFF0C%u53EA%u9700%u8981%u770B%u770B%60%u539F%u6765%u7684hash%u503C%u65B0%u589E%u7684%u90A3%u4E2Abit%u662F1%u8FD8%u662F0%60%u5C31%u597D%u4E86%uFF0C%u662F0%u7684%u8BDD%u7D22%u5F15%u6CA1%u53D8%uFF0C%u662F1%u7684%u8BDD%u7D22%u5F15%u53D8%u6210%60%u539F%u7D22%u5F15+oldCap%60%u3002%u53EF%u4EE5%u770B%u770B%u4E0B%u56FE%u4E3A16%u6269%u5145%u4E3A32%u7684resize%u793A%u610F%u56FE%uFF1A%0A%21%5Bresize16to32%5D%28./1506567534575.png%29%0A%u8FD9%u4E2A%u8BBE%u8BA1%u786E%u5B9E%u975E%u5E38%u7684%u5DE7%u5999%uFF0C%u65E2%u7701%u53BB%u4E86%u91CD%u65B0%u8BA1%u7B97hash%u503C%u7684%u65F6%u95F4%uFF0C%u800C%u4E14%u540C%u65F6%uFF0C%u7531%u4E8E%u65B0%u589E%u76841bit%u662F0%u8FD8%u662F1%u53EF%u4EE5%u8BA4%u4E3A%u662F%u968F%u673A%u7684%uFF0C%u56E0%u6B64resize%u7684%u8FC7%u7A0B%uFF0C%60%u5747%u5300%u7684%u628A%u4E4B%u524D%u7684%u51B2%u7A81%u7684%u8282%u70B9%u5206%u6563%u5230%u65B0%u7684bucket%60%u4E86%u3002%0A%0A%3Eresize%u6E90%u7801%0A%60%60%60java%0A%20%20%20%20final%20Node%3CK%2CV%3E%5B%5D%20resize%28%29%20%7B%0A%20%20%20%20%20%20%20%20Node%3CK%2CV%3E%5B%5D%20oldTab%20%3D%20table%3B%0A%20%20%20%20%20%20%20%20int%20oldCap%20%3D%20%28oldTab%20%3D%3D%20null%29%20%3F%200%20%3A%20oldTab.length%3B%0A%20%20%20%20%20%20%20%20int%20oldThr%20%3D%20threshold%3B%0A%20%20%20%20%20%20%20%20int%20newCap%2C%20newThr%20%3D%200%3B%0A%20%20%20%20%20%20%20%20if%20%28oldCap%20%3E%200%29%20%7B%0A%09%20%20%20%20%20%20%20%20//%20%u8D85%u8FC7%u6700%u5927%u503C%u5C31%u4E0D%u518D%u6269%u5145%u4E86%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20%28oldCap%20%3E%3D%20MAXIMUM_CAPACITY%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20threshold%20%3D%20Integer.MAX_VALUE%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20oldTab%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20//%20%u6CA1%u8D85%u8FC7%u6700%u5927%u503C%uFF0C%u5C31%u6269%u5145%u4E3A%u539F%u6765%u76842%u500D%0A%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20%28%28newCap%20%3D%20oldCap%20%3C%3C%201%29%20%3C%20MAXIMUM_CAPACITY%20%26%26%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20oldCap%20%3E%3D%20DEFAULT_INITIAL_CAPACITY%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20newThr%20%3D%20oldThr%20%3C%3C%201%3B%20//%20double%20threshold%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20else%20if%20%28oldThr%20%3E%200%29%20//%20initial%20capacity%20was%20placed%20in%20threshold%0A%20%20%20%20%20%20%20%20%20%20%20%20newCap%20%3D%20oldThr%3B%0A%20%20%20%20%20%20%20%20else%20%7B%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20zero%20initial%20threshold%20signifies%20using%20defaults%0A%20%20%20%20%20%20%20%20%20%20%20%20newCap%20%3D%20DEFAULT_INITIAL_CAPACITY%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20newThr%20%3D%20%28int%29%28DEFAULT_LOAD_FACTOR%20*%20DEFAULT_INITIAL_CAPACITY%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20//%20%u8BA1%u7B97%u65B0%u7684resize%u4E0A%u9650%0A%20%20%20%20%20%20%20%20if%20%28newThr%20%3D%3D%200%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20float%20ft%20%3D%20%28float%29newCap%20*%20loadFactor%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20newThr%20%3D%20%28newCap%20%3C%20MAXIMUM_CAPACITY%20%26%26%20ft%20%3C%20%28float%29MAXIMUM_CAPACITY%20%3F%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%28int%29ft%20%3A%20Integer.MAX_VALUE%29%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20threshold%20%3D%20newThr%3B%0A%20%20%20%20%20%20%20%20@SuppressWarnings%28%7B%22rawtypes%22%2C%22unchecked%22%7D%29%0A%20%20%20%20%20%20%20%20%20%20%20%20Node%3CK%2CV%3E%5B%5D%20newTab%20%3D%20%28Node%3CK%2CV%3E%5B%5D%29new%20Node%5BnewCap%5D%3B%0A%20%20%20%20%20%20%20%20table%20%3D%20newTab%3B%0A%20%20%20%20%20%20%20%20if%20%28oldTab%20%21%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20//%20%u628A%u6BCF%u4E2Abucket%u90FD%u79FB%u52A8%u5230%u65B0%u7684buckets%u4E2D%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20%28int%20j%20%3D%200%3B%20j%20%3C%20oldCap%3B%20++j%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Node%3CK%2CV%3E%20e%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28%28e%20%3D%20oldTab%5Bj%5D%29%20%21%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20oldTab%5Bj%5D%20%3D%20null%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28e.next%20%3D%3D%20null%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20newTab%5Be.hash%20%26%20%28newCap%20-%201%29%5D%20%3D%20e%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20if%20%28e%20instanceof%20TreeNode%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%28%28TreeNode%3CK%2CV%3E%29e%29.split%28this%2C%20newTab%2C%20j%2C%20oldCap%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%20//%20preserve%20order%0A%09%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%u94FE%u8868%u4F18%u5316%u91CDhash%u7684%u4EE3%u7801%u5757%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Node%3CK%2CV%3E%20loHead%20%3D%20null%2C%20loTail%20%3D%20null%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Node%3CK%2CV%3E%20hiHead%20%3D%20null%2C%20hiTail%20%3D%20null%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Node%3CK%2CV%3E%20next%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20do%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20next%20%3D%20e.next%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%u539F%u7D22%u5F15%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28%28e.hash%20%26%20oldCap%29%20%3D%3D%200%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28loTail%20%3D%3D%20null%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20loHead%20%3D%20e%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20loTail.next%20%3D%20e%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20loTail%20%3D%20e%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%u539F%u7D22%u5F15+oldCap%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28hiTail%20%3D%3D%20null%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hiHead%20%3D%20e%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hiTail.next%20%3D%20e%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hiTail%20%3D%20e%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%20while%20%28%28e%20%3D%20next%29%20%21%3D%20null%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%u539F%u7D22%u5F15%u653E%u5230bucket%u91CC%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28loTail%20%21%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20loTail.next%20%3D%20null%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20newTab%5Bj%5D%20%3D%20loHead%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20%u539F%u7D22%u5F15+oldCap%u653E%u5230bucket%u91CC%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20%28hiTail%20%21%3D%20null%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hiTail.next%20%3D%20null%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20newTab%5Bj%20+%20oldCap%5D%20%3D%20hiHead%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20return%20newTab%3B%0A%20%20%20%20%7D%0A%60%60%60%0A%23%20%u4F7F%u7528%u573A%u666F%0AHashMap%u662F%u57FA%u4E8EMap%u63A5%u53E3%u7684%u5B9E%u73B0%uFF0C%u7528%u4E8E%u5B58%u50A8%u952E-%u503C%u5BF9%uFF0C%u5B83%u53EF%u4EE5%u63A5%u6536null%u7684%u952E%u503C%uFF0C%u662F%u975E%u540C%u6B65%u7684%uFF0C%0AHashMap%u5B58%u50A8%u7740Entry%28hash%2C%20key%2C%20value%2C%20next%29%u5BF9%u8C61%u3002%0A%0A%u5185%u5B58%u7F13%u5B58%0A%0A%23%20%u5E38%u89C1%u95EE%u9898%0A%23%23%20HashMap%u4E0EHashtable%u7684%u533A%u522B%0A%20Hashtable%uFF1AHashtable%u662F%u9057%u7559%u7C7B%uFF0C%u5F88%u591A%u6620%u5C04%u7684%u5E38%u7528%u529F%u80FD%u4E0EHashMap%u7C7B%u4F3C%uFF0C%u4E0D%u540C%u7684%u662F%u5B83%u627F%u81EADictionary%u7C7B%uFF0C%u5E76%u4E14%u662F%u7EBF%u7A0B%u5B89%u5168%u7684%uFF0C%u4EFB%u4E00%u65F6%u95F4%u53EA%u6709%u4E00%u4E2A%u7EBF%u7A0B%u80FD%u5199Hashtable%uFF0C%u5E76%u53D1%u6027%u4E0D%u5982ConcurrentHashMap%uFF0C%u56E0%u4E3AConcurrentHashMap%u5F15%u5165%u4E86%u5206%u6BB5%u9501%u3002Hashtable%u4E0D%u5EFA%u8BAE%u5728%u65B0%u4EE3%u7801%u4E2D%u4F7F%u7528%uFF0C%u4E0D%u9700%u8981%u7EBF%u7A0B%u5B89%u5168%u7684%u573A%u5408%u53EF%u4EE5%u7528HashMap%u66FF%u6362%uFF0C%u9700%u8981%u7EBF%u7A0B%u5B89%u5168%u7684%u573A%u5408%u53EF%u4EE5%u7528ConcurrentHashMap%u66FF%u6362%u3002%0A%20%0AHashMap%20%u5B9E%u73B0%u4E86%u6240%u6709map%u7C7B%u7684%u65B9%u6CD5%u3002%u5E76%u5141%u8BB8%u4F7F%u7528%20null%20%u4F5C%u4E3A%20key%20%u548C%20value%u3002%0AHashMap%u548CHashTable%u5927%u81F4%u76F8%u540C%u3002%20%0A%u533A%u522B%u5728%u4E8EHashMap%u4E0D%u662F%u540C%u6B65%u7684%uFF0C%u5E76%u5141%u8BB8null%u503C%uFF0CHashTable%u662F%u540C%u6B65%uFF0C%u5E76%u4E14%u4E0D%u5141%u8BB8null%u503C%u3002%20%0AHashMap%u4E0D%u4FDD%u8BC1%u653E%u5165%u7684%u5143%u7D20%u6309%u5E8F%u5B58%u50A8%u3002%u540C%u65F6%u5B83%u4E5F%u4E0D%u4FDD%u8BC1%u5F53%u524D%u7684%u5B58%u50A8%u987A%u5E8F%u4F1A%u4FDD%u6301%u5F88%u957F%u65F6%u95F4%u3002%0A%0A%23%23%20%u4E3A%u4EC0%u4E48HashMap%u7684Buckets%u5927%u5C0F%u4E3A2%u7684%u6307%u6570%uFF1F%u4E0D%u91C7%u6837%u7D20%u6570%uFF1F%0A%u5728HashMap%u4E2D%uFF0C%u54C8%u5E0C%u6876%u6570%u7EC4table%u7684%u957F%u5EA6length%u5927%u5C0F%u5FC5%u987B%u4E3A2%u7684n%u6B21%u65B9%28%u4E00%u5B9A%u662F%60%u5408%u6570%60%29%uFF0C%u8FD9%u662F%u4E00%u79CD%u975E%u5E38%u89C4%u7684%u8BBE%u8BA1%uFF0C%0A%u5E38%u89C4%u7684%u8BBE%u8BA1%u662F%u628A%u6876%u7684%u5927%u5C0F%u8BBE%u8BA1%u4E3A%u7D20%u6570%u3002%u76F8%u5BF9%u6765%u8BF4%60%u7D20%u6570%u5BFC%u81F4%u51B2%u7A81%u7684%u6982%u7387%u8981%u5C0F%u4E8E%u5408%u6570%60%uFF0CHashtable%u521D%u59CB%u5316%u6876%u5927%u5C0F%u4E3A11%uFF0C%u5C31%u662F%u6876%u5927%u5C0F%u8BBE%u8BA1%u4E3A%u7D20%u6570%u7684%u5E94%u7528%uFF08%60Hashtable%60%u6269%u5BB9%u540E%u4E0D%u80FD%u4FDD%u8BC1%u8FD8%u662F%u7D20%u6570%uFF09%u3002%0A%0AHashMap%u91C7%u7528%u8FD9%u79CD%u975E%u5E38%u89C4%u8BBE%u8BA1%uFF0C%u4E3B%u8981%u662F%60%u4E3A%u4E86%u5728%u53D6%u6A21%u548C%u6269%u5BB9%u65F6%u505A%u4F18%u5316%uFF0C%u540C%u65F6%u4E3A%u4E86%u51CF%u5C11%u51B2%u7A81%60%uFF0C%0AHashMap%u5B9A%u4F4D%u54C8%u5E0C%u6876%u7D22%u5F15%u4F4D%u7F6E%u65F6%uFF0C%u4E5F%u52A0%u5165%u4E86%60%u9AD8%u4F4D%u53C2%u4E0E%u8FD0%u7B97%60%u7684%u8FC7%u7A0B%u3002%0A%0A%23%23%20HashMap%u51FA%u73B0%u54C8%u5E0C%u78B0%u649E%u600E%u4E48%u5904%u7406%u5417%uFF1F%0A%u4E3A%u89E3%u51B3%u54C8%u5E0C%u8868hash%u78B0%u649E%uFF0C%u53EF%u4EE5%u91C7%u7528%60%u5F00%u653E%u5730%u5740%u6CD5%60%u548C%60%u94FE%u5730%u5740%u6CD5%60%u7B49%u6765%u89E3%u51B3%u95EE%u9898%uFF0CJava%u4E2DHashMap%u91C7%u7528%u4E86%u94FE%u5730%u5740%u6CD5%u3002%0A%23%23%23%20%u94FE%u5730%u5740%u6CD5%0A%u7B80%u5355%u6765%u8BF4%uFF0C%u5C31%u662F%60%u6570%u7EC4%60%u52A0%60%u94FE%u8868%60%u7684%u7ED3%u5408%u3002%u5728%u6BCF%u4E2A%u6570%u7EC4%u5143%u7D20%u4E0A%u90FD%u4E00%u4E2A%u94FE%u8868%u7ED3%u6784%uFF0C%u5F53%u6570%u636E%u88ABHash%u540E%uFF0C%u5F97%u5230%u6570%u7EC4%u4E0B%u6807%uFF0C%u628A%u6570%u636E%u653E%u5728%u5BF9%u5E94%u4E0B%u6807%u5143%u7D20%u7684%u94FE%u8868%u4E0A%u3002%0A%0A%23%23%23%20%u5F00%u653E%u5730%u5740%u6CD5%0A*%20%60%u7EBF%u6027%u5F00%u653E%u5730%u5740%u6CD5%60%0A%u7EBF%u6027%u5F00%u653E%u5730%u5740%u6CD5%u5C31%u662F%u5728hash%u4E4B%u540E%uFF0C%u5F53%u53D1%u73B0%u5728%u4F4D%u7F6E%u4E0A%u5DF2%u7ECF%u5B58%u5728%u4E86%u4E00%u4E2A%u53D8%u91CF%u4E4B%u540E%uFF0C%u653E%u5230%u5B83%u4E0B%u4E00%u4E2A%u4F4D%u7F6E%uFF0C%u5047%u5982%u4E0B%u4E00%u4E2A%u4F4D%u7F6E%u4E5F%u51B2%u7A81%uFF0C%u5219%u7EE7%u7EED%u5411%u4E0B%uFF0C%u4F9D%u6B21%u7C7B%u63A8%uFF0C%u76F4%u5230%u627E%u5230%u6CA1%u6709%u53D8%u91CF%u7684%u4F4D%u7F6E%uFF0C%u653E%u8FDB%u53BB%u3002%0A*%20%60%u5E73%u65B9%u5F00%u653E%u5730%u5740%u6CD5%60%0A%u5E73%u65B9%u5730%u5740%u6CD5%u5C31%u662F%u5728hash%u4E4B%u540E%uFF0C%u5F53%u6B63%u786E%u4F4D%u7F6E%u4E0A%u5B58%u5728%u51B2%u7A81%uFF0C%u4E0D%u653E%u5230%u6328%u7740%u7684%u4E0B%u4E00%u4E2A%u4F4D%u7F6E%uFF0C%u800C%u662F%u653E%u5230%u7B2C2%5E0%u4F4D%u7F6E%uFF0C%u5047%u5982%u7EE7%u7EED%u51B2%u7A81%u653E%u52302%5E1%u7684%u4F4D%u7F6E%uFF0C%u4F9D%u6B212%5E3...%20%u76F4%u5230%u9047%u5230%u4E0D%u51B2%u7A81%u7684%u4F4D%u7F6E%u653E%u8FDB%u53BB%u3002%0A*%20%60%u53CC%u6563%u5217%u5F00%u653E%u5730%u5740%u6CD5%60%0A%u53CC%u6563%u5217%u540C%u4E0A%uFF0C%u4E0D%u8FC7%u4E0D%u662F%u653E%u52302%5E%u7684%u4F4D%u7F6E%uFF0C%u800C%u662F%u653E%u5230key%20-%20hash%28key%2C%20tablesize%29%u7684%u4F4D%u7F6E%uFF0C%u5047%u5982%u7EE7%u7EED%u51B2%u7A81%uFF0C%u5219%u653E%u52302%20%28key%20-%20hash%28key%2Ctablesize%29%29%u7684%u4F4D%u7F6E%u3002%0A%0A%u5982%u679C%u8FD8%u662F%u4EA7%u751F%u4E86%u9891%u7E41%u7684%u78B0%u649E%uFF0C%u4F1A%u53D1%u751F%u4EC0%u4E48%u95EE%u9898%u5462%uFF1F%0A%u4F5C%u8005%u6CE8%u91CA%u8BF4%uFF0C%u4ED6%u4EEC%u4F7F%u7528%u6811%u6765%u5904%u7406%u9891%u7E41%u7684%u78B0%u649E%28we%20use%20trees%20to%20handle%20large%20sets%20of%20collisions%20in%20bins%29%uFF0C%u5728JEP-180%u4E2D%uFF0C%u63CF%u8FF0%u4E86%u8FD9%u4E2A%u95EE%u9898%uFF1A%0A%3EImprove%20the%20performance%20of%20java.util.HashMap%20under%20%60high%20hash-collision%20conditions%60%20by%20using%20%60balanced%20trees%60%20rather%20than%20%60linked%20lists%60%20to%20store%20map%20entries.%20Implement%20the%20same%20improvement%20in%20the%20LinkedHashMap%20class.%0A%0A%u4E4B%u524D%u5DF2%u7ECF%u63D0%u8FC7%uFF0C%u5728%u83B7%u53D6HashMap%u7684%u5143%u7D20%u65F6%uFF0C%u57FA%u672C%u5206%u4E24%u6B65%uFF1A%0A*%20%u9996%u5148%u6839%u636EhashCode%28%29%u505Ahash%uFF0C%u7136%u540E%u786E%u5B9Abucket%u7684index%uFF1B%0A*%20%u5982%u679Cbucket%u7684%u8282%u70B9%u7684key%u4E0D%u662F%u6211%u4EEC%u9700%u8981%u7684%uFF0C%u5219%u901A%u8FC7keys.equals%28%29%u5728%u94FE%u4E2D%u627E%u3002%0A%0A%u5728%60Java%208%u4E4B%u524D%60%u7684%u5B9E%u73B0%u4E2D%u662F%u7528%u94FE%u8868%u89E3%u51B3%u51B2%u7A81%u7684%uFF0C%u5728%u4EA7%u751F%u78B0%u649E%u7684%u60C5%u51B5%u4E0B%uFF0C%u8FDB%u884Cget%u65F6%uFF0C%u4E24%u6B65%u7684%u65F6%u95F4%u590D%u6742%u5EA6%u662F%60O%281%29+O%28n%29%60%uFF0Cn%u4E3Abucket.size%u3002%u56E0%u6B64%uFF0C%u5F53%u78B0%u649E%u5F88%u5389%u5BB3%u7684%u65F6%u5019n%u5F88%u5927%uFF0CO%28n%29%u7684%u901F%u5EA6%u663E%u7136%u662F%u5F71%u54CD%u901F%u5EA6%u7684%u3002%0A%0A%u56E0%u6B64%u5728%60Java%208%60%u4E2D%uFF0C%u5229%u7528%60%u7EA2%u9ED1%u6811%60%u66FF%u6362%u94FE%u8868%uFF0C%u8FD9%u6837%u590D%u6742%u5EA6%u5C31%u53D8%u6210%u4E86%60O%281%29+O%28logn%29%60%u4E86%uFF0C%u8FD9%u6837%u5728n%u5F88%u5927%u7684%u65F6%u5019%uFF0C%u80FD%u591F%u6BD4%u8F83%u7406%u60F3%u7684%u89E3%u51B3%u8FD9%u4E2A%u95EE%u9898%uFF0C%u5728Java%208%uFF1AHashMap%u7684%u6027%u80FD%u63D0%u5347%u4E00%u6587%u4E2D%u6709%u6027%u80FD%u6D4B%u8BD5%u7684%u7ED3%u679C%u3002%0A%0A%23%23%20HashMap%u67E5%u8BE2%u65F6%u590D%u6742%u5EA6%u4E00%u76F4%u662FO%281%29%u5417%uFF1F%0AJava8%u4E4B%u524D%uFF0C%u6700%u5DEE%u662F%60O%281%29+O%28n/backetSize%29%60%0AJava8%uFF0C%u590D%u6742%u5EA6%u4E3A%60O%281%29+O%28log%28backetSize%29%29%60%0A%0A%23%23%20%u4F60%u77E5%u9053HashMap%u7684%u5DE5%u4F5C%u539F%u7406%u5417%uFF1F%0A%u901A%u8FC7hash%u7684%u65B9%u6CD5%uFF0C%u901A%u8FC7put%u548Cget%u5B58%u50A8%u548C%u83B7%u53D6%u5BF9%u8C61%u3002%0A*%20%u5B58%u50A8%u5BF9%u8C61%u65F6%28%60put%60%29%uFF0C%u6211%u4EEC%u5C06K/V%u4F20%u7ED9put%u65B9%u6CD5%uFF0C%u5B83%u8C03%u7528hashCode%u8BA1%u7B97hash%u4ECE%u800C%u5F97%u5230bucket%u4F4D%u7F6E%uFF0C%u8FDB%u4E00%u6B65%u5B58%u50A8%uFF0CHashMap%u4F1A%u6839%u636E%u5F53%u524Dbucket%u7684%u5360%u7528%u60C5%u51B5%u81EA%u52A8%u8C03%u6574%u5BB9%u91CF%28%u8D85%u8FC7Load%20Facotr%u5219resize%u4E3A%u539F%u6765%u76842%u500D%29%u3002%0A*%20%u83B7%u53D6%u5BF9%u8C61%u65F6%28%60get%60%29%uFF0C%u6211%u4EEC%u5C06K%u4F20%u7ED9get%u65B9%u6CD5%uFF0C%u5B83%u8C03%u7528hashCode%u8BA1%u7B97hash%u4ECE%u800C%u5F97%u5230bucket%u4F4D%u7F6E%uFF0C%u5E76%u8FDB%u4E00%u6B65%u8C03%u7528equals%28%29%u65B9%u6CD5%u786E%u5B9A%u952E%u503C%u5BF9%u3002%u5982%u679C%u53D1%u751F%u78B0%u649E%u7684%u65F6%u5019%uFF0CHashmap%u901A%u8FC7%u94FE%u8868%u5C06%u4EA7%u751F%u78B0%u649E%u51B2%u7A81%u7684%u5143%u7D20%u7EC4%u7EC7%u8D77%u6765%uFF0C%u5728Java%208%u4E2D%uFF0C%u5982%u679C%u4E00%u4E2Abucket%u4E2D%u78B0%u649E%u51B2%u7A81%u7684%u5143%u7D20%u8D85%u8FC7%u67D0%u4E2A%u9650%u5236%28%u9ED8%u8BA4%u662F8%29%uFF0C%u5219%u4F7F%u7528%u7EA2%u9ED1%u6811%u6765%u66FF%u6362%u94FE%u8868%uFF0C%u4ECE%u800C%u63D0%u9AD8%u901F%u5EA6%u3002%0A%0A%23%23%20%u4F60%u77E5%u9053get%u548Cput%u7684%u539F%u7406%u5417%uFF1Fequals%28%29%u548ChashCode%28%29%u7684%u90FD%u6709%u4EC0%u4E48%u4F5C%u7528%uFF1F%0A%u901A%u8FC7%u5BF9key%u7684hashCode%28%29%u8FDB%u884Chashing%uFF0C%u5E76%u8BA1%u7B97%u4E0B%u6807%60%28%20n-1%20%26%20hash%29%60%uFF0C%u4ECE%u800C%u83B7%u5F97buckets%u7684%u4F4D%u7F6E%u3002%0A%u5982%u679C%u4EA7%u751F%u78B0%u649E%uFF0C%u5219%u5229%u7528key.equals%28%29%u65B9%u6CD5%u53BB%u94FE%u8868%u6216%u6811%u4E2D%u53BB%u67E5%u627E%u5BF9%u5E94%u7684%u8282%u70B9%0A%0A%23%23%20%u4F60%u77E5%u9053hash%u7684%u5B9E%u73B0%u5417%uFF1F%u4E3A%u4EC0%u4E48%u8981%u8FD9%u6837%u5B9E%u73B0%uFF1F%0A%u5728Java%201.8%u7684%u5B9E%u73B0%u4E2D%uFF0C%u662F%u901A%u8FC7hashCode%28%29%u7684%u9AD816%u4F4D%60%u5F02%u6216%60%u4F4E16%u4F4D%u5B9E%u73B0%u7684%uFF1A%60%28h%20%3D%20k.hashCode%28%29%29%20%5E%20%28h%20%3E%3E%3E%2016%29%60%uFF0C%u4E3B%u8981%u662F%u4ECEspeed%u3001utility%u3001quality%u6765%u8003%u8651%u7684%uFF0C%u8FD9%u4E48%u505A%u53EF%u4EE5%u5728bucket%u7684n%u6BD4%u8F83%u5C0F%u7684%u65F6%u5019%uFF0C%u4E5F%u80FD%u4FDD%u8BC1%u8003%u8651%u5230%u9AD8%u4F4Ebit%u90FD%u53C2%u4E0E%u5230hash%u7684%u8BA1%u7B97%u4E2D%uFF0C%u540C%u65F6%u4E0D%u4F1A%u6709%u592A%u5927%u7684%u5F00%u9500%u3002%0A%0A%23%23%20%u5982%u679CHashMap%u7684%u5927%u5C0F%u8D85%u8FC7%u4E86%u8D1F%u8F7D%u56E0%u5B50%28load%20factor%29%u5B9A%u4E49%u7684%u5BB9%u91CF%uFF0C%u600E%u4E48%u529E%uFF1F%0A%u5982%u679C%u8D85%u8FC7%u4E86%u8D1F%u8F7D%u56E0%u5B50%28%u9ED8%u8BA40.75%29%uFF0C%u5219%u4F1A%u91CD%u65B0resize%u4E00%u4E2A%u539F%u6765%u957F%u5EA6%u4E24%u500D%u7684HashMap%uFF0C%u5E76%u4E14%u91CD%u65B0%u8C03%u7528hash%u65B9%u6CD5%u3002%0A%0A%23%20%u57FA%u7840%u77E5%u8BC6%0A%23%23%20%20Java%u8FD0%u7B97%u7B26%0AA%20%3D%200011%201100%0AB%20%3D%200000%201101%0A%60%uFF06%60%uFF08%u4F4D%u8FD0%u7B97%uFF09%uFF1A%u5982%u679C%u76F8%u5BF9%u5E94%u4F4D%u90FD%u662F1%uFF0C%u5219%u7ED3%u679C%u4E3A1%uFF0C%u5426%u5219%u4E3A0%u3002%u5982%60A%26B%60%3D%600000%201100%60%0A%60%5E%60%uFF08%u5F02%u6216%u8FD0%u7B97%uFF09%uFF1A%u5982%u679C%u76F8%u5BF9%u5E94%u4F4D%u503C%u76F8%u540C%uFF0C%u5219%u7ED3%u679C%u4E3A0%uFF0C%u5426%u5219%u4E3A1%u3002%u5982%60%uFF08A%20%5E%20B%uFF09%60%3D%600011%200001%60%0A%60%3E%3E%3E%60%uFF08%u6309%u4F4D%u53F3%u79FB%u8865%u96F6%u64CD%u4F5C%u7B26%uFF09%uFF1A%u5DE6%u64CD%u4F5C%u6570%u7684%u503C%u6309%u53F3%u64CD%u4F5C%u6570%u6307%u5B9A%u7684%u4F4D%u6570%u53F3%u79FB%uFF0C%u79FB%u52A8%u5F97%u5230%u7684%u7A7A%u4F4D%u4EE5%u96F6%u586B%u5145%u3002%u5982%60A%3E%3E%3E2%60%3D%600000%201111%60%0A%0A%0A%23%20%u53C2%u8003%0A%5BJava%20HashMap%u5DE5%u4F5C%u539F%u7406%u53CA%u5B9E%u73B0%5D%28http%3A//yikun.github.io/2015/04/01/Java%20HashMap%u5DE5%u4F5C%u539F%u7406%u53CA%u5B9E%u73B0%29%0A%5BJava%208%u7CFB%u5217%u4E4B%u91CD%u65B0%u8BA4%u8BC6HashMap%5D%28https%3A//tech.meituan.com/java-hashmap.html%29%0A%5B%u6563%u5217%u51B2%u7A81%u5904%u7406%uFF1A%u94FE%u5730%u5740%u6CD5%5D%28http%3A//www.nowamagic.net/academy/detail/3008060%29%0A%5BHashMap%20%u53EF%u89C6%u5316%5D%28https%3A//visualgo.net/en/hashtable%29</center><br/></en-note>