---
title: 分布式任务调度系统的技术选型
date: 2020-07-29
tags: [大数据]
---

一个调度系统，涉及的功能可按任务执行周期分为3部分：
* **执行前：**
  * 任务定义，如任务关系可以用DAG定义；
  * 任务调度，如按cron调度；
  * 任务分发，如通过mq分发任务；
* **执行中：**
  * 任务执行资源隔离：不同作业可在不同的机器上执行；
  * 任务执行并发控制：同一类型的作业可控制并发数；
  * 任务执行进度查询：可查询作业中每个任务的执行情况；
* **任务后：**
  * 任务执行异常通知：任务执行异常有邮件/消息通知机制；
  * 任务执行情况统计：可以分析历史执行情况，评估SLA；

<!-- more -->  
# 典型的工作处理流程
工作流程通常由一系列的任务组成，并由调度器或事件触发，其通常包含5个步骤：
* 下载任务数据；
* 分发任务数据到处理节点；
* 监控处理进度直到任务结束；
* 获取任务处理结果并生成任务处理报告；
* 发送任务处理报告；

# 选型要求
* 作业定义：支持DAG，DAG流程支持模板复用；
* 任务定义：至少支持bash，jdbc，hive，hdfs；
* 任务调度：支持CRON，支持事件触发，区间补数据（串行/并行）；
* 任务隔离：作业可隔离执行环境，如采用kubernetes，每个task实例启动一个pod，可采用不同的镜像；
* 任务执行：支持任务并行，支持重新执行；
* 任务回溯：支持补数据（backfill/catchup）：正向/逆向；
* 数据血缘：task节点可以手动配置/自动生成至少table级别的数据血缘，在任务执行成功后推送到元数据服务；
* 异常处理：资源不足时支持任务堆积，节点异常时支持故障转移，机器重启时支持任务恢复，任务超时/异常时可自动重试；
* 监控告警：监控任务状态，集成邮件/sentry/wechat告警；
* 安全权限：支持多租户，DAG流程图可按租户隔离，支持LDAP身份验证，Kerberos安全通信；
* 定制开发：有完善的API接口（REST/Java）
* 高可用：任务调度节点高可用（避免单点故障），任务执行节点高可用（避免任务过多时产生阻塞）；

# 选型比较
* hadoop调度：oozie、azkaban
* 通用调度：airflow、xxl-job、dolphin scheduler
* 数据处理+调度：nifi

# 参考
- [Existing-Workflow-systems](https://github.com/common-workflow-language/common-workflow-language/wiki/Existing-Workflow-systems)
- [github-awesome-pipeline](https://github.com/pditommaso/awesome-pipeline)
- [阿里-基于DAG的分布式任务调度平台：Maat](https://mp.weixin.qq.com/s?__biz=MzIzOTU0NTQ0MA==&mid=2247488054&idx=1&sn=215ca504afbb3234acd1c4146173b3c7&chksm=e9292f39de5ea62f05bbbc0140d2ef9e88fd1dd6900fd85a066f087c7700837fbef680ce3f86&mpshare=1&scene=1&srcid=0816xzwzUqCYArqbaqiTkgd6&sharer_sharetime=1593736825889&sharer_shareid=c34b9250c3b65723d4a3c176ade2782f&key=0e4d83a1aaa2ddc8403b62d5df36de3b90ae18d3d8065108234d8f22cd3a3d034fcf2df50e4cbf636c43c92a347f377318abc45427053e4b1453d4f3eb73ee212b2283f40d62ce17b68c9352a0f6684c&ascene=1&uin=MjMxNDgyMzI2MA%3D%3D&devicetype=Windows+10+x64&version=62090070&lang=zh_CN&exportkey=AbPMXYoZZfkTshlVVjR3z18%3D&pass_ticket=VWMiNZeJNL4X5wHsDdDQ0H7rU6tCU9crSAS4TSJ%2BxvzD5v1xKQj3Wp7IomwNYx2Y)
- [NiFi 在马蜂窝信息流推荐引擎中的使用及扩展](https://mp.weixin.qq.com/s?__biz=Mzg5MTA4Mzg5NA==&mid=2247484213&idx=2&sn=b1b43170b3f648c7614e4f6500198833&chksm=cfd38e2cf8a4073a3f44bef1304d3309d151da44db8e2b480d7b0a55bce85ab38d09fd94ae51&mpshare=1&scene=1&srcid=0624lsHbVCmyBRefcXoLxTf6&sharer_sharetime=1592988350503&sharer_shareid=c34b9250c3b65723d4a3c176ade2782f&key=0f539cbc0453aa76380486ec4892819e9d4e62323f90a7c2b53f1b3384dc6a43d726deeb3df5136a78e280c2fb279473d264a2750b4ee2193e122843971eb865c390e5cd21a9023f0e7187553ad52814&ascene=1&uin=MjMxNDgyMzI2MA%3D%3D&devicetype=Windows+10+x64&version=62090070&lang=zh_CN&exportkey=AaRreYnA9Rqyij5w4%2Fzgnww%3D&pass_ticket=eO1PEp6dyacyhKbCSkkBE42%2FiCouwxCJeSsk%2BMPRQfeQO861kaZF4865BimpAqEz)
- [Real-Time Data Flows with Apache NiFi.pdf](http://docs.dc.servyou-it.com/download/attachments/58560520/Real-Time Data Flows with Apache NiFi.pdf?version=1&modificationDate=1593430463000&api=v2)
- [Apache Nifi的工作原理](https://cloud.tencent.com/developer/article/1596567)